<!DOCTYPE html>
<html lang="zh" data-darkmode="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的算法书 - 红黑树</title>
    <meta name="description" content="这是一本关于算法的书">
    <meta name="author" content="rainboy">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lxgw-wenkai-web/1.520.0/style.min.css" integrity="sha512-VqbHLQtJ5icD77Z4HH8NsrtoRJlTAkOKdSrymwYZtZ1Ipbit8L/Pp8RIeHS2vpNk2bVOszUUDotVl7sK403sjw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/markdown.css">
    <link rel="stylesheet" href="/prism-theme/prism-tomorrow.css">
</head>
<body>
    <aside class="panel">
    <ul class="panel-list">
      <li><a href="/"><i class="fa fa-home"></i></a></li>
      <li><a href="javascript:void(0);" onclick="showMenuModal()"><i class="fa fa-list"></i></a></li>
    </ul>
    <ul class="panel-list">
      <li><input type="radio" class="J_darkMode" value="auto" name="darkmode" id="darkmode-auto" checked=""><label for="darkmode-auto"><i class="fa fa-adjust"></i></label></li>
      <li><input type="radio" class="J_darkMode" value="light" name="darkmode" id="darkmode-light"><label for="darkmode-light"><i class="fa fa-sun-o"></i></label></li>
      <li><input type="radio" class="J_darkMode" value="dark" name="darkmode" id="darkmode-dark"><label for="darkmode-dark"><i class="fa fa-moon-o"></i></label></li>
    </ul>
  </aside>
    <div id="modal-menu" class="modal-menu" style="display:none;">
  <div class="modal-menu-mask" onclick="hideMenuModal()"></div>
  <div class="modal-menu-content">
    <button class="modal-menu-close" onclick="hideMenuModal()">×</button>
    <h2>目录</h2>
    

<div class="chapter-list">
  
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="base">基础</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="base/double_point/index.html">双指针</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="base/binary_search/index.html">二分查找</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="base/sparse_table/index.html">ST稀疏表</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter2">第二章</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter2/chapter2-1">第一节</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter2/chapter2-2">第二节</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter3">第三章 动态规划</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128"><path fill="#c62828" d="m31.37 26.45l.17-18.43L40 5.43l9.75 16.73z"/><path fill="#37474f" d="M36.76 20.48s-2.6-11.89.34-13.07c5.23-2.09 9.31 11.65 9.31 11.65z" opacity="0.59"/><path fill="#f44336" d="M20.59 32.81c-.09-1.63-2.29-14.63 1.05-21.88c1.53-3.31 7.81-5.51 13.43-6.76c1.39-.31 4.98-.51 7.21 2.05c2.01 2.31 4.98 7.37 7.91 15l-2.11 4.54s-2.91-7.7-5.82-14.06c-2.41-5.27-5.47-3.52-5.78-2.29c-.56 2.26 2.3 14.51 2.3 14.51c-4.16 1.77-18.19 8.89-18.19 8.89"/><path fill="#455a64" d="m42.36 17.37l1.75-8.5L51 4.88l8.29.02l6.9 5.59l1.91 10.9l-8.33-2.81l-1.13-7.81l-7.64-.19l-1.02 6.21z"/><path fill="#ff7555" d="M35.06 4.18c-5.62 1.24-11.27 3.03-13.43 6.76c-1.24 2.14-1.96 7.75-1.82 12.96c1.09-1.72 5.54-4.69 8.86-6.13c3.31-1.44 3.69-2.87 3.74-3.5c.25-2.86.01-5.22.85-7.24c1.06-2.56 2.57-2.88 3.45-3.01c-.67 0-1.26.07-1.65.16m4.53.28c-.54-.19-1.08-.31-1.6-.37c.54.14 1.07.32 1.6.37"/><path fill="none" stroke="#784d30" stroke-miterlimit="10" stroke-width="9.816" d="M89.99 109.24c14.88-3.95 19.32-20.76 23.54-22.17"/><path fill="#c62828" d="M104.48 74.9c1.09 7.09 3.23 7.62 6.96 7.43c5.65-.28 6.27-1.58 7.53-11.26c1.56-12.02-2.95-28.77-6.84-40.25c-2.06-6.08-1.85-10.25-6.44-14.89c-2.52-2.55-12.33-6.3-15.18-1.42c-1.96 3.36-.98 6.77.89 9.47c5.43 7.86 10.43 33.77 13.08 50.92"/><path fill="#37474f" d="M93.06 26.91c1.04 2.13 2.11 4.89 2.98 8c8.86-.27 18.46 3.98 18.46 3.72c0-.22-.75-5.99-3.19-11.71c-1.06-2.48-4.29-9.28-8.29-8.62c-5.03.84-9.96 8.61-9.96 8.61" opacity="0.59"/><path fill="#f44336" d="M85.95 39.19c2.61-5.58 12.26-19.78 17.81-20.24c2.75-.23 5.84 5.46 6.97 8.57c3.17 8.73 6.62 22.43 7.63 36.73c.63 8.92-1 16.02-4.36 18.97c12.88-2.41 7.85-30.52 6.76-36.34c-3.67-19.49-8.48-26.84-12.17-30.77c-2.82-3-15.1-9.35-21.58-9.05c-4.99.23-15.91 9.56-18.89 14.73c-.88 1.52 17.83 17.4 17.83 17.4"/><path fill="#ff7555" d="M68.66 123.73c16.9-1.34 27.59-10.84 28.71-19.85c3.86-31.14-3.77-76.17-34.16-84.9c-3.39-.97-9.35-2.25-14.53-2.25c-6.03 0-15.33 1.27-22.01 5.85c-12.18 8.36-15.43 20.26-16.23 26.16c-2.95 21.63 36.96 76.68 58.22 74.99"/><path fill="#c62828" d="M97.37 103.88c2.01-16.2.91-36.15-4.89-52.81c-3.02-3.9-6.38-5.73-9.16-4.83c-3.34 1.08-6.27 5.53-5.21 10.01c0 0 8.09 32.46 2.59 52.99c-3.64 13.59-13.23 14.52-13.23 14.52c.4 0 .8 0 1.19-.03c16.91-1.34 27.59-10.84 28.71-19.85"/><path fill="#f44336" d="M18.62 120.38c5.1 1.61 18.51 3.62 42.26 3.62c21.33 0 21.18-7.59 22.94-16.5c3.62-18.38-1.34-78.26-38.49-79.55C12.84 26.81 9.59 45.89 7.14 66.61c-2.56 21.67-1.96 29.78-.72 38.61c1.61 11.54 8.69 14.05 12.2 15.16"/><path fill="#37474f" d="M90.05 59.81c-.86-4.52-2.08-9.49-4.09-14.34l-2.42.11c1.81 4.11 3.31 8.94 4.39 14.63c3.45 18.23 3.85 30.45 3.67 37.08c-.11 3.98 2.08 4 2.19-.25c.17-6.81-.29-18.99-3.74-37.23"/><path fill="#e2a610" d="M92.53 95.21a2.626 2.626 0 0 0-1.73 2.92l1.3 7.54a2.19 2.19 0 0 0 3.17 1.64l3.62-1.85c1.18-.6 1.56-2.11.81-3.2l-4.17-6.06a2.62 2.62 0 0 0-3-.99"/><path fill="#ffca28" d="M94.23 105.83c-.18-.33-1.14-5.47-1.43-7.81c-.32-2.63.81-2.78.98-2.92a2.62 2.62 0 0 0-2.99 3.03l1.3 7.54c.15 1.03.96 1.75 1.89 1.87c.42.05.86-.01 1.28-.23l.84-.43c-.04-.01-1.28.03-1.87-1.05"/><path fill="#546e7a" d="m119.95 92.13l-9.34.83c-.86.08-1.63-.56-1.7-1.43l-.71-7.93c-.08-.86.56-1.63 1.43-1.7l9.34-.83c.86-.08 1.63.56 1.7 1.43l.71 7.93c.07.86-.57 1.62-1.43 1.7"/><path fill="#37474f" d="m117.41 92.43l-8.84.79c-.86.08-1.63-.56-1.7-1.43l-.72-8.09c-.08-.86.56-1.63 1.43-1.7l8.84-.79c.86-.08 1.63.56 1.7 1.43l.72 8.09c.07.86-.57 1.62-1.43 1.7"/><path fill="#a06841" d="m111.28 101.56l-2.71-14.28c-.05-.24.12-.47.37-.49l7.13-.72c.2-.02.39.11.44.31l3.52 13.18c.23.86-.3 1.75-1.17 1.95l-5.68 1.3c-.87.19-1.74-.37-1.9-1.25"/><path fill="#fff59d" d="m49.47 58.81l-15.43-.46c-1.35 0-2.45-1.1-2.45-2.45l.21-7.94c0-1.33 1.06-2.42 2.39-2.45l15.26.41a2.453 2.453 0 0 1 2.52 2.4l-.03 7.99c.01 1.37-1.09 2.5-2.47 2.5" opacity="0.65"/><path fill="#ff7555" d="M87.01 7.05c-3.78.12-11.09 5.62-15.58 10.49c2.32-.19 7.81 2.38 12.37 5.9c.91.7 3.15.57 4.61-1c1.33-1.43 2.58-2.53 3.92-3.95c7.86-8.33 14.04-4.2 14.04-4.2c-6.5-4.23-14.42-7.39-19.36-7.24"/><path fill="#546e7a" d="M86.27 46.23C81.34 33.91 71.39 22.06 49.65 20.1c-15.1-1.36-25.27 5.65-29.41 8.19c-.92.56-1.95 1.26-2.65 2.22c-.89 1.22-1.01 2.22-1.01 2.22s13.1-12.23 32.87-10.48c11.3 1 26.14 4.77 34.31 23.87c.69-.17 1.62-.07 2.51.11"/><path fill="#ff7555" d="M69.35 114.25s-15.98 1.11-33.95.13c-9.47-.52-16.41-1.88-17.82-3.71c-1.74-2.26-3.8-4.45-3.8-16.07c0-7.83 2.89-14.14 8.49-14.28c4.28-.11 49.21-.6 45.82-.6s-6.45 7.43-6.14 15.44c.76 19.63 7.4 19.09 7.4 19.09"/><path fill="#ff7555" d="M53.67 94.6c.35-.1 3.53.18 6.07-1.59c.96-.67 1.72-1.23 2.33-1.87c.59-6 2.95-10.89 5.59-11.37c.09-.02.18-.04.26-.05c-3.92.08-35.97-1.1-45.98-.95c-4.64.07-8.22 5.53-7.9 11.95c.67 1.19 1.75 2.47 3.4 2.72c3.24.49 35.88 1.27 36.23 1.16"/><path fill="#fff59d" d="M53.67 94.6c.35-.1 3.53.18 6.07-1.59c.96-.67 1.72-1.23 2.33-1.87c.59-6 2.95-10.89 5.59-11.37c.09-.02.18-.04.26-.05c-3.92.08-35.97-1.1-45.98-.95c-4.64.07-8.22 5.53-7.9 11.95c.67 1.19 1.75 2.47 3.4 2.72c3.24.49 35.88 1.27 36.23 1.16" opacity="0.45"/><path fill="#c62828" d="M74.42 89.7c-.34-5.22-1.57-7.7-2.69-8.88c-1.03-1.1-2.64-1.19-4.93-1.08c-1.42.07-4.01 1.43-5.1 9.46v-.01c-.86 1.95-3.11 3.89-6.84 3.89l-35.75-1.16c-3.58-.23-4.89-3.65-5.06-3.96c0 0-.52 2.41-.03 3.94c.62 1.92 2.9 3.06 5.09 3.06l35.75 1.16c2.85 0 5.02-1.13 6.42-2.18q-.09 1.86-.09 4.05c0 15.36 4.43 16.52 7.26 16.39c2.83-.14 5.6-1.22 6.05-3.73c.64-3.51.57-10.89-.08-20.95"/></svg> </span>
              
             背包 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter3/knapsack/01-knapsack">01背包</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter3/knapsack/multiple-knapsack">多重背包</a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path fill="#00bcd4" d="M19 22h10v20H19zM32 8h10v34H32zM6 30h10v12H6z"/><g fill="#3f51b5"><path d="m11 8l10 10V8z"/><path d="m9.394 22.437l-2.828-2.828l9.969-9.969l2.828 2.828z"/></g></svg> </span>
              
             线性动态规划 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter3/linear/lcs">lcs</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter3/linear/lis">lis</a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><path fill="#000" d="M16 120h480V16H16Zm32-72h416v40H48Zm192 96H16v96h224Zm-32 64H48v-32h160Zm64 32h224v-96H272Zm32-64h160v32H304Zm-152 96H16v88h136Zm-32 56H48v-24h72Zm72 32h128v-88H192Zm32-56h64v24h-64Zm136 56h136v-88H360Zm32-56h72v24h-72ZM121.442 443.278A52.721 52.721 0 1 0 68.722 496a52.78 52.78 0 0 0 52.72-52.722m-73.442 0A20.721 20.721 0 1 1 68.722 464A20.745 20.745 0 0 1 48 443.278m92.853 0a52.721 52.721 0 1 0 52.721-52.72a52.78 52.78 0 0 0-52.721 52.72m73.442 0a20.721 20.721 0 1 1-20.721-20.72a20.745 20.745 0 0 1 20.726 20.72Zm51.41 0a52.721 52.721 0 1 0 52.721-52.72a52.78 52.78 0 0 0-52.721 52.72m73.442 0a20.721 20.721 0 1 1-20.721-20.72a20.745 20.745 0 0 1 20.721 20.72m104.131-52.72A52.721 52.721 0 1 0 496 443.278a52.78 52.78 0 0 0-52.722-52.72m0 73.442A20.721 20.721 0 1 1 464 443.278A20.745 20.745 0 0 1 443.278 464"/></svg> </span>
              
             区间动态规划 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22"><path fill="currentColor" d="M7 8H5V7H4V6H3V4h6v2H8v1H7m-4 5H1v-2h2m9 2H9v-2h3m9 2h-3v-2h3M7 13H5v-1H4v-2h1V9h2v1h1v2H7m9 1h-2v-1h-1v-2h1V9h2v1h1v2h-1m2 6h-6v-2h1v-1h1v-1h2v1h1v1h1Z"/></svg> </span>
              
             动态规划优化 
            </span>
          </a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-folder-open-o"></i>
          <a href="javascript:void(0);" class="menu-no-link">第四章 数据结构</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/binary-indexed-tree">树状数组</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/segment-tree">线段树</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/stack">栈</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/stack/表达式">表达式求值</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/stack/monotonic-stack">单调栈</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/BST">二叉搜索树</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/RBTree">红黑树</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/AVL">AVL</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/fhq-treap">FHQ-Treap</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-folder-open-o"></i>
          <a href="javascript:void(0);" class="menu-no-link">第五章 图论</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="graph/diameter_of_tree">树的直径</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="graph/center_of_tree">树的中心</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="graph/pseudotree">基环树</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="graph/kruskal">Kruskal</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="graph/floyed">floyed算法</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="string">字符串</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="string/最小表示法/index.html">最小表示法</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math">数学</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="thinkMind">思维方式</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="thinkMind/index.html">总结</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="thinkMind/约束松弛.html">约束松弛</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="thinkMind/特例化-归纳.html">特例化-归纳</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math">数学</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math/向上取整.html">向上取整</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math/log.html">对数</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math/集合.html">集合</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math/反证法.html">反证法</a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none"><path d="m12 3l4.33 6.75H7.67zM3 14h7v7H3zm18 3.5a3.5 3.5 0 1 1-7 0a3.5 3.5 0 0 1 7 0"/><path stroke="currentColor" stroke-linecap="square" stroke-width="2" d="m12 3l4.33 6.75H7.67zM3 14h7v7H3zm18 3.5a3.5 3.5 0 1 1-7 0a3.5 3.5 0 0 1 7 0Z"/></g></svg> </span>
              
             组合数学 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math/combinatorics/112_combinatorial_problems/index.html">112个组合问题</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-folder-open-o"></i>
          <a href="javascript:void(0);" class="menu-no-link">附录</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22"/></svg> </span>
              
             技巧 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/quickIO.html">quickIO</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/assert的使用.html">assert断言的使用</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/写题步奏.html">写题步奏</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/macos.html">macos下使用万能头文件</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/常用命令.html">常用命令</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/常用变量名.html">常用变量名</a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="#0065a9" d="m29.01 5.03l-5.766-2.776a1.74 1.74 0 0 0-1.989.338L2.38 19.8a1.166 1.166 0 0 0-.08 1.647q.037.04.077.077l1.541 1.4a1.165 1.165 0 0 0 1.489.066L28.142 5.75A1.158 1.158 0 0 1 30 6.672v-.067a1.75 1.75 0 0 0-.99-1.575"/><path fill="#007acc" d="m29.01 26.97l-5.766 2.777a1.745 1.745 0 0 1-1.989-.338L2.38 12.2a1.166 1.166 0 0 1-.08-1.647q.037-.04.077-.077l1.541-1.4A1.165 1.165 0 0 1 5.41 9.01l22.732 17.24A1.158 1.158 0 0 0 30 25.328v.072a1.75 1.75 0 0 1-.99 1.57"/><path fill="#1f9cf0" d="M23.244 29.747a1.745 1.745 0 0 1-1.989-.338A1.025 1.025 0 0 0 23 28.684V3.316a1.024 1.024 0 0 0-1.749-.724a1.74 1.74 0 0 1 1.989-.339l5.765 2.772A1.75 1.75 0 0 1 30 6.6v18.8a1.75 1.75 0 0 1-.991 1.576Z"/></svg> </span>
              
             vscode 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/vscode/如何调试.html">如何调试</a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="#000"><path d="m3.463 12.86l-.005-.07zm7.264.69l-3.034-3.049l1.014-1.014l3.209 3.225l3.163-3.163l1.014 1.014l-3.034 3.034l3.034 3.05l-1.014 1.014l-3.209-3.225L8.707 17.6l-1.014-1.014l3.034-3.034z"/><path fill-rule="evenodd" d="M16.933 5.003V6h1.345l2.843-2.842l1.014 1.014l-2.692 2.691l.033.085a13.8 13.8 0 0 1 .885 4.912q0 .503-.034.995l-.005.075h3.54v1.434h-3.72l-.01.058c-.303 1.653-.891 3.16-1.692 4.429l-.06.094l3.423 3.44l-1.017 1.012l-3.274-3.29l-.099.11c-1.479 1.654-3.395 2.646-5.483 2.646c-2.12 0-4.063-1.023-5.552-2.723l-.098-.113l-3.209 3.208l-1.014-1.014l3.366-3.365l-.059-.095c-.772-1.25-1.34-2.725-1.636-4.34l-.01-.057H0V12.93h3.538l-.005-.075a14 14 0 0 1-.034-.995c0-1.743.31-3.39.863-4.854l.032-.084l-2.762-2.776L2.65 3.135L5.5 6h1.427v-.997a5.003 5.003 0 0 1 10.006 0m-8.572 0V6H15.5v-.997a3.569 3.569 0 0 0-7.138 0zm9.8 2.522l-.034-.09H5.733l-.034.09a12.3 12.3 0 0 0-.766 4.335c0 2.76.862 5.201 2.184 6.92c1.32 1.716 3.036 2.649 4.813 2.649s3.492-.933 4.813-2.65c1.322-1.718 2.184-4.16 2.184-6.919c0-1.574-.28-3.044-.766-4.335" clip-rule="evenodd"/></g></svg> </span>
              
             lldb的使用 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/lldb/lldb如何调试.html">lldb如何调试</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/lldb/lldb实现display命令.html">lldb实现display命令</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/lldb/lldbinit.html">lldbinit使用</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/gdb/lldbpython脚本入门.html">lldbpython脚本入门</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/software/常用软件.html">常用软件</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
  </ul>
  

</div>


  </div>
</div>
<script>
function showMenuModal() {
  document.getElementById('modal-menu').style.display = 'block';
}
function hideMenuModal() {
  document.getElementById('modal-menu').style.display = 'none';
}
</script>

    <main>
        
<article class="page">
    <header class="page-header">
        <h1>红黑树</h1>
    </header>
    
    <div class="container">
        <div class="heti markdown-body">
    <nav class="table-of-contents"><ol><li><a href="#%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AE%9A%E4%B9%89">红黑树的数据结构定义</a></li><li><a href="#%E6%97%8B%E8%BD%AC%E6%93%8D%E4%BD%9C">旋转操作</a><ol><li><a href="#%E5%B7%A6%E6%97%8B-(left-rotation)">左旋 (Left Rotation)</a></li><li><a href="#%E5%8F%B3%E6%97%8B-(right-rotation)">右旋 (Right Rotation)</a></li><li><a href="#%E6%95%B0%E5%AD%A6%E8%A1%A8%E7%A4%BA">数学表示</a></li><li><a href="#%E6%97%8B%E8%BD%AC%E7%9A%84%E6%80%A7%E8%B4%A8">旋转的性质</a></li><li><a href="#%E6%B5%8B%E8%AF%95%E6%97%8B%E8%BD%AC%E6%93%8D%E4%BD%9C">测试旋转操作</a></li><li><a href="#%E6%97%8B%E8%BD%AC%E5%9C%A8%E7%BA%A2%E9%BB%91%E6%A0%91%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8">旋转在红黑树中的应用</a></li></ol></li><li><a href="#%E5%AE%8C%E6%95%B4%E7%9A%84%E6%97%8B%E8%BD%AC%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B">完整的旋转实现示例</a></li><li><a href="#%E6%97%8B%E8%BD%AC%E6%93%8D%E4%BD%9C%E7%9A%84%E6%95%B0%E5%AD%A6%E6%80%A7%E8%B4%A8">旋转操作的数学性质</a><ol><li><a href="#1.-%E4%BF%9D%E6%8C%81%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E6%80%A7%E8%B4%A8">1. 保持二叉搜索树性质</a></li><li><a href="#2.-%E5%8F%AF%E9%80%86%E6%80%A7">2. 可逆性</a></li><li><a href="#3.-%E9%AB%98%E5%BA%A6%E5%8F%98%E5%8C%96">3. 高度变化</a></li></ol></li><li><a href="#%E6%97%8B%E8%BD%AC%E5%9C%A8%E5%B9%B3%E8%A1%A1%E6%93%8D%E4%BD%9C%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8">旋转在平衡操作中的作用</a></li><li><a href="#%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E5%AE%9A%E4%B9%89">红黑树的定义</a></li><li><a href="#%E6%80%A7%E8%B4%A85%E4%BF%9D%E6%8C%81%E5%B9%B3%E8%A1%A1%E7%9A%84%E5%8E%9F%E5%9B%A0%E3%80%82">性质5保持平衡的原因。</a></li><li><a href="#%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C">插入操作</a><ol><li><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%89%A7%E8%A1%8C%E6%A0%87%E5%87%86bst%E6%8F%92%E5%85%A5">第一步：执行标准BST插入</a></li><li><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E4%BF%AE%E5%A4%8D%E7%BA%A2%E9%BB%91%E6%A0%91%E6%80%A7%E8%B4%A8">第二步：修复红黑树性质</a><ol><li><a href="#a.-%E7%88%B6%E8%8A%82%E7%82%B9-p-%E6%98%AF%E7%A5%96%E7%88%B6%E8%8A%82%E7%82%B9-g-%E7%9A%84%E5%B7%A6%E5%AD%A9%E5%AD%90">A. 父节点 p 是祖父节点 g 的左孩子</a></li><li><a href="#b.-%E7%88%B6%E8%8A%82%E7%82%B9-p-%E6%98%AF%E7%A5%96%E7%88%B6%E8%8A%82%E7%82%B9-g-%E7%9A%84%E5%8F%B3%E5%AD%A9%E5%AD%90">B. 父节点 p 是祖父节点 g 的右孩子</a></li></ol></li><li><a href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E7%A1%AE%E4%BF%9D%E6%A0%B9%E8%8A%82%E7%82%B9%E4%B8%BA%E9%BB%91%E8%89%B2">第三步：确保根节点为黑色</a></li><li><a href="#%E6%8F%92%E5%85%A5%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93">插入流程总结</a></li></ol></li><li><a href="#%E5%88%A0%E9%99%A4">删除</a><ol><li><a href="#%E6%83%85%E5%86%B51%EF%BC%9A%E5%85%84%E5%BC%9F-s-%E6%98%AF%E7%BA%A2%E8%89%B2">情况1：兄弟 s 是红色</a></li><li><a href="#%E6%83%85%E5%86%B52%EF%BC%9A%E5%85%84%E5%BC%9F-s-%E6%98%AF%E9%BB%91%E8%89%B2%EF%BC%8C%E4%B8%94%E5%85%84%E5%BC%9F%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%AD%A9%E5%AD%90%E9%83%BD%E6%98%AF%E9%BB%91%E8%89%B2">情况2：兄弟 s 是黑色，且兄弟的两个孩子都是黑色</a></li><li><a href="#%E6%83%85%E5%86%B53%EF%BC%9A%E5%85%84%E5%BC%9F-s-%E6%98%AF%E9%BB%91%E8%89%B2%EF%BC%8C%E5%85%84%E5%BC%9F%E7%9A%84%E5%B7%A6%E5%AD%A9%E5%AD%90%E6%98%AF%E7%BA%A2%E8%89%B2%EF%BC%8C%E5%8F%B3%E5%AD%A9%E5%AD%90%E6%98%AF%E9%BB%91%E8%89%B2(%E8%BF%91%E7%82%B9)">情况3：兄弟 s 是黑色，兄弟的左孩子是红色，右孩子是黑色(近点)</a></li><li><a href="#%E6%83%85%E5%86%B54%EF%BC%9A%E5%85%84%E5%BC%9F-s-%E6%98%AF%E9%BB%91%E8%89%B2%EF%BC%8C%E5%85%84%E5%BC%9F%E7%9A%84%E5%8F%B3%E5%AD%A9%E5%AD%90%E6%98%AF%E7%BA%A2%E8%89%B2(%E8%BF%9C%E7%82%B9)(%E8%BE%B9%E7%95%8C)">情况4：兄弟 s 是黑色，兄弟的右孩子是红色(远点)(边界)</a></li></ol></li></ol></nav><h2 id="%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AE%9A%E4%B9%89" tabindex="-1">红黑树的数据结构定义</h2>
<p>首先，我们需要定义红黑树的数据结构，包括颜色和节点的定义：</p>
<div class="language-haskell line-numbers-mode">
    <div class="code-info-header">
        <span>haskell</span>
        <div class="zeroclipboard-container">
            <div class="clipboard-copy">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
                </svg>
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success">
                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                </svg>
                copy
            </div>
        </div>
    </div>
    <pre class="language-haskell">
        <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div>
        <code><span class="token comment">-- | 定义颜色</span>
<span class="token keyword">data</span> <span class="token constant">Color</span> <span class="token operator">=</span> <span class="token constant">R</span> <span class="token operator">|</span> <span class="token constant">B</span> <span class="token keyword">deriving</span> <span class="token punctuation">(</span><span class="token constant">Eq</span><span class="token punctuation">,</span> <span class="token constant">Show</span><span class="token punctuation">)</span>

<span class="token comment">-- | 定义红黑树节点</span>
<span class="token comment">-- | 'Empty' 代表空叶子节点（NIL），在红黑树中视为黑色</span>
<span class="token comment">-- | 'Node c l k r' 代表一个节点，c 是颜色，k 是键值，l 和 r 分别是左右子树</span>
<span class="token keyword">data</span> <span class="token constant">RBTree</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Empty</span>
              <span class="token operator">|</span> <span class="token constant">Node</span> <span class="token constant">Color</span> <span class="token punctuation">(</span><span class="token constant">RBTree</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token hvariable">a</span> <span class="token punctuation">(</span><span class="token constant">RBTree</span> <span class="token hvariable">a</span><span class="token punctuation">)</span>
              <span class="token keyword">deriving</span> <span class="token punctuation">(</span><span class="token constant">Eq</span><span class="token punctuation">)</span>

<span class="token comment">-- | 自定义 Show 实例</span>
<span class="token keyword">instance</span> <span class="token punctuation">(</span><span class="token constant">Show</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">Show</span> <span class="token punctuation">(</span><span class="token constant">RBTree</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token keyword">where</span>
    <span class="token builtin">show</span> <span class="token constant">Empty</span> <span class="token operator">=</span> <span class="token string">"NIL"</span>
    <span class="token builtin">show</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span><span class="token punctuation">)</span> <span class="token operator">=</span> 
        <span class="token keyword">let</span> <span class="token hvariable">colorStr</span> <span class="token operator">=</span> <span class="token keyword">case</span> <span class="token hvariable">c</span> <span class="token keyword">of</span> <span class="token constant">R</span> <span class="token operator">-></span> <span class="token string">"R"</span> <span class="token punctuation">;</span> <span class="token constant">B</span> <span class="token operator">-></span> <span class="token string">"B"</span>
        <span class="token keyword">in</span> <span class="token string">"("</span> <span class="token operator">++</span> <span class="token hvariable">colorStr</span> <span class="token operator">++</span> <span class="token string">":"</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">k</span> <span class="token operator">++</span> <span class="token string">" "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">l</span> <span class="token operator">++</span> <span class="token string">" "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">r</span> <span class="token operator">++</span> <span class="token string">")"</span>
</code>
    </pre>
</div>
<h2 id="%E6%97%8B%E8%BD%AC%E6%93%8D%E4%BD%9C" tabindex="-1">旋转操作</h2>
<p>旋转是红黑树维护平衡的基本操作。旋转不会破坏二叉搜索树的性质，但会改变树的结构，用于在插入和删除后重新平衡树。</p>
<figure><img src="./images/1.svg" alt=""></figure>
<figure><div class="image-wrapper" style="display:flex; flex-direction:column; align-items:center; width:100%; height:100%;"> <a class="image-extension-badge" style="align-self: flex-end;" href="https://excalidraw.roj.ac.cn//#url=https%3A%2F%2Frbook2.roj.ac.cn%2Fdata-structure%2FRBTree%2Fimages%2F%25E7%25BA%25A2%25E9%25BB%2591%25E6%25A0%2591-%25E6%258F%2592%25E5%2585%25A5%25E7%259A%2584%25E8%25AF%2581%25E6%2598%258E.excalidraw.svg" target="_blank" title="Open in Excalidraw">Open in Excalidraw</a> <img src="./images/%E7%BA%A2%E9%BB%91%E6%A0%91-%E6%8F%92%E5%85%A5%E7%9A%84%E8%AF%81%E6%98%8E.excalidraw.svg" alt=""> </div></figure>
<h3 id="%E5%B7%A6%E6%97%8B-(left-rotation)" tabindex="-1">左旋 (Left Rotation)</h3>
<p>左旋将某个节点向左旋转，使其右子节点成为新的子树根：</p>
<div class="language-haskell line-numbers-mode">
    <div class="code-info-header">
        <span>haskell</span>
        <div class="zeroclipboard-container">
            <div class="clipboard-copy">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
                </svg>
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success">
                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                </svg>
                copy
            </div>
        </div>
    </div>
    <pre class="language-haskell">
        <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div>
        <code><span class="token comment">-- | 左旋操作</span>
<span class="token comment">-- | rotateLeft (Node c l k (Node rc rl rk rr)) = Node c (Node c l k rl) rk rr</span>
<span class="token hvariable">rotateLeft</span> <span class="token operator">::</span> <span class="token constant">RBTree</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token constant">RBTree</span> <span class="token hvariable">a</span>
<span class="token hvariable">rotateLeft</span> <span class="token constant">Empty</span> <span class="token operator">=</span> <span class="token constant">Empty</span>  <span class="token comment">-- 空树无法旋转</span>
<span class="token hvariable">rotateLeft</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">case</span> <span class="token hvariable">r</span> <span class="token keyword">of</span>
        <span class="token constant">Empty</span> <span class="token operator">-></span> <span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span>  <span class="token comment">-- 右子树为空，无法旋转</span>
        <span class="token constant">Node</span> <span class="token hvariable">rc</span> <span class="token hvariable">rl</span> <span class="token hvariable">rk</span> <span class="token hvariable">rr</span> <span class="token operator">-></span> 
            <span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token hvariable">rl</span><span class="token punctuation">)</span> <span class="token hvariable">rk</span> <span class="token hvariable">rr</span>  <span class="token comment">-- 新的根节点是原来的右子节点</span>
</code>
    </pre>
</div>
<h3 id="%E5%8F%B3%E6%97%8B-(right-rotation)" tabindex="-1">右旋 (Right Rotation)</h3>
<p>右旋是左旋的镜像操作，将某个节点向右旋转：</p>
<div class="language-haskell line-numbers-mode">
    <div class="code-info-header">
        <span>haskell</span>
        <div class="zeroclipboard-container">
            <div class="clipboard-copy">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
                </svg>
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success">
                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                </svg>
                copy
            </div>
        </div>
    </div>
    <pre class="language-haskell">
        <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div>
        <code><span class="token comment">-- | 右旋操作</span>
<span class="token comment">-- | rotateRight (Node c (Node lc ll lk lr) k r) = Node c ll lk (Node c lr k r)</span>
<span class="token hvariable">rotateRight</span> <span class="token operator">::</span> <span class="token constant">RBTree</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token constant">RBTree</span> <span class="token hvariable">a</span>
<span class="token hvariable">rotateRight</span> <span class="token constant">Empty</span> <span class="token operator">=</span> <span class="token constant">Empty</span>  <span class="token comment">-- 空树无法旋转</span>
<span class="token hvariable">rotateRight</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">case</span> <span class="token hvariable">l</span> <span class="token keyword">of</span>
        <span class="token constant">Empty</span> <span class="token operator">-></span> <span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span>  <span class="token comment">-- 左子树为空，无法旋转</span>
        <span class="token constant">Node</span> <span class="token hvariable">lc</span> <span class="token hvariable">ll</span> <span class="token hvariable">lk</span> <span class="token hvariable">lr</span> <span class="token operator">-></span> 
            <span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">ll</span> <span class="token hvariable">lk</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">lr</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span><span class="token punctuation">)</span>  <span class="token comment">-- 新的根节点是原来的左子节点</span>
</code>
    </pre>
</div>
<h3 id="%E6%95%B0%E5%AD%A6%E8%A1%A8%E7%A4%BA" tabindex="-1">数学表示</h3>
<p>旋转操作的数学表示（如你所提供的公式）：</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="right center left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>rotate_left</mtext><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>b</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>rotate_right</mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>b</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{array}{rcl}
\text{rotate\_left}(a, x, (b, y, c)) &amp; = &amp; ((a, x, b), y, c) \\
\text{rotate\_right}((a, x, b), y, c) &amp; = &amp; (a, x, (b, y, c))
\end{array}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">rotate_left</span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mclose">))</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">rotate_right</span></span><span class="mopen">((</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">=</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">((</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mclose">))</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></eqn></section><p>其中：</p>
<ul>
<li><code>rotate_left(a, x, (b, y, c))</code> 表示对以 <code>x</code> 为根，左子树为 <code>a</code>，右子树为 <code>(b, y, c)</code> 的树进行左旋</li>
<li><code>rotate_right((a, x, b), y, c)</code> 表示对以 <code>y</code> 为根，左子树为 <code>(a, x, b)</code>，右子树为 <code>c</code> 的树进行右旋</li>
</ul>
<h3 id="%E6%97%8B%E8%BD%AC%E7%9A%84%E6%80%A7%E8%B4%A8" tabindex="-1">旋转的性质</h3>
<ol>
<li><strong>保持BST性质</strong>：旋转操作不会破坏二叉搜索树的有序性质</li>
<li><strong>改变树高</strong>：旋转可以改变子树的高度，用于平衡</li>
<li><strong>可逆性</strong>：左旋和右旋互为逆操作</li>
<li><strong>局部操作</strong>：旋转只影响涉及的节点及其直接子节点</li>
</ol>
<h3 id="%E6%B5%8B%E8%AF%95%E6%97%8B%E8%BD%AC%E6%93%8D%E4%BD%9C" tabindex="-1">测试旋转操作</h3>
<div class="language-haskell line-numbers-mode">
    <div class="code-info-header">
        <span>haskell</span>
        <div class="zeroclipboard-container">
            <div class="clipboard-copy">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
                </svg>
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success">
                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                </svg>
                copy
            </div>
        </div>
    </div>
    <pre class="language-haskell">
        <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div>
        <code><span class="token comment">-- | 测试旋转操作</span>
<span class="token hvariable">testRotations</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">testRotations</span> <span class="token operator">=</span> <span class="token keyword">do</span>
    <span class="token builtin">putStrLn</span> <span class="token string">"--- 旋转操作测试 ---"</span>
    
    <span class="token comment">-- 构建一个简单的树用于测试</span>
    <span class="token keyword">let</span> <span class="token hvariable">tree</span> <span class="token operator">=</span> <span class="token constant">Node</span> <span class="token constant">B</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token constant">B</span> <span class="token constant">Empty</span> <span class="token number">1</span> <span class="token constant">Empty</span><span class="token punctuation">)</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token constant">B</span> <span class="token constant">Empty</span> <span class="token number">3</span> <span class="token constant">Empty</span><span class="token punctuation">)</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"原始树: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">tree</span>
    
    <span class="token comment">-- 测试左旋</span>
    <span class="token keyword">let</span> <span class="token hvariable">leftRotated</span> <span class="token operator">=</span> <span class="token hvariable">rotateLeft</span> <span class="token hvariable">tree</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"左旋后: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">leftRotated</span>
    
    <span class="token comment">-- 构建另一个树用于测试右旋</span>
    <span class="token keyword">let</span> <span class="token hvariable">tree2</span> <span class="token operator">=</span> <span class="token constant">Node</span> <span class="token constant">B</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token constant">B</span> <span class="token constant">Empty</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token constant">B</span> <span class="token constant">Empty</span> <span class="token number">2</span> <span class="token constant">Empty</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">3</span> <span class="token constant">Empty</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"原始树2: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">tree2</span>
    
    <span class="token comment">-- 测试右旋</span>
    <span class="token keyword">let</span> <span class="token hvariable">rightRotated</span> <span class="token operator">=</span> <span class="token hvariable">rotateRight</span> <span class="token hvariable">tree2</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"右旋后: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">rightRotated</span>
    
    <span class="token comment">-- 测试旋转的可逆性</span>
    <span class="token keyword">let</span> <span class="token hvariable">doubleLeft</span> <span class="token operator">=</span> <span class="token hvariable">rotateLeft</span> <span class="token punctuation">(</span><span class="token hvariable">rotateLeft</span> <span class="token hvariable">tree</span><span class="token punctuation">)</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"连续左旋两次: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">doubleLeft</span>
    
    <span class="token keyword">let</span> <span class="token hvariable">leftThenRight</span> <span class="token operator">=</span> <span class="token hvariable">rotateRight</span> <span class="token punctuation">(</span><span class="token hvariable">rotateLeft</span> <span class="token hvariable">tree</span><span class="token punctuation">)</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"左旋后右旋: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">leftThenRight</span>
</code>
    </pre>
</div>
<h3 id="%E6%97%8B%E8%BD%AC%E5%9C%A8%E7%BA%A2%E9%BB%91%E6%A0%91%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8" tabindex="-1">旋转在红黑树中的应用</h3>
<p>旋转通常与重新着色结合使用，用于：</p>
<ol>
<li><strong>插入修复</strong>：当插入新节点破坏红黑树性质时</li>
<li><strong>删除修复</strong>：当删除节点破坏黑高平衡时</li>
<li><strong>调整结构</strong>：将红色节点上移或下移</li>
</ol>
<p>旋转是红黑树自平衡机制的核心，理解旋转对于掌握红黑树的插入和删除操作至关重要。</p>
<h2 id="%E5%AE%8C%E6%95%B4%E7%9A%84%E6%97%8B%E8%BD%AC%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B" tabindex="-1">完整的旋转实现示例</h2>
<p>下面是一个更详细的 Haskell 实现，包含测试用例：</p>
<div class="language-haskell line-numbers-mode">
    <div class="code-info-header">
        <span>haskell</span>
        <div class="zeroclipboard-container">
            <div class="clipboard-copy">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
                </svg>
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success">
                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                </svg>
                copy
            </div>
        </div>
    </div>
    <pre class="language-haskell">
        <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div>
        <code><span class="token comment">-- | 从列表构建红黑树（简单的BST插入，不考虑红黑性质）</span>
<span class="token hvariable">insert</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Ord</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token constant">RBTree</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token constant">RBTree</span> <span class="token hvariable">a</span>
<span class="token hvariable">insert</span> <span class="token hvariable">x</span> <span class="token constant">Empty</span> <span class="token operator">=</span> <span class="token constant">Node</span> <span class="token constant">B</span> <span class="token constant">Empty</span> <span class="token hvariable">x</span> <span class="token constant">Empty</span>  <span class="token comment">-- 新节点默认为黑色</span>
<span class="token hvariable">insert</span> <span class="token hvariable">x</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span><span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token hvariable">x</span> <span class="token operator">&lt;</span> <span class="token hvariable">k</span>     <span class="token operator">=</span> <span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token punctuation">(</span><span class="token hvariable">insert</span> <span class="token hvariable">x</span> <span class="token hvariable">l</span><span class="token punctuation">)</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span>
    <span class="token operator">|</span> <span class="token hvariable">x</span> <span class="token operator">></span> <span class="token hvariable">k</span>     <span class="token operator">=</span> <span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token punctuation">(</span><span class="token hvariable">insert</span> <span class="token hvariable">x</span> <span class="token hvariable">r</span><span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token builtin">otherwise</span> <span class="token operator">=</span> <span class="token constant">Node</span> <span class="token hvariable">c</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span>  <span class="token comment">-- 重复值不插入</span>

<span class="token comment">-- | 中序遍历（验证旋转不破坏BST性质）</span>
<span class="token hvariable">inorder</span> <span class="token operator">::</span> <span class="token constant">RBTree</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
<span class="token hvariable">inorder</span> <span class="token constant">Empty</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token hvariable">inorder</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">_</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">inorder</span> <span class="token hvariable">l</span> <span class="token operator">++</span> <span class="token punctuation">[</span><span class="token hvariable">k</span><span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token hvariable">inorder</span> <span class="token hvariable">r</span>

<span class="token comment">-- | 计算树的高度（验证旋转改变树高）</span>
<span class="token hvariable">height</span> <span class="token operator">::</span> <span class="token constant">RBTree</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token constant">Int</span>
<span class="token hvariable">height</span> <span class="token constant">Empty</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token hvariable">height</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token hvariable">_</span> <span class="token hvariable">l</span> <span class="token hvariable">k</span> <span class="token hvariable">r</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token builtin">max</span> <span class="token punctuation">(</span><span class="token hvariable">height</span> <span class="token hvariable">l</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">height</span> <span class="token hvariable">r</span><span class="token punctuation">)</span>

<span class="token comment">-- | 测试旋转操作</span>
<span class="token hvariable">testRotations</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">testRotations</span> <span class="token operator">=</span> <span class="token keyword">do</span>
    <span class="token keyword">let</span> <span class="token hvariable">tree</span> <span class="token operator">=</span> <span class="token constant">Node</span> <span class="token constant">B</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token constant">B</span> <span class="token constant">Empty</span> <span class="token number">1</span> <span class="token constant">Empty</span><span class="token punctuation">)</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token constant">Node</span> <span class="token constant">B</span> <span class="token constant">Empty</span> <span class="token number">3</span> <span class="token constant">Empty</span><span class="token punctuation">)</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"原始树: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">tree</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"中序遍历: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token punctuation">(</span><span class="token hvariable">inorder</span> <span class="token hvariable">tree</span><span class="token punctuation">)</span>
    
    <span class="token keyword">let</span> <span class="token hvariable">leftRotated</span> <span class="token operator">=</span> <span class="token hvariable">rotateLeft</span> <span class="token hvariable">tree</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"左旋后: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">leftRotated</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"中序遍历: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token punctuation">(</span><span class="token hvariable">inorder</span> <span class="token hvariable">leftRotated</span><span class="token punctuation">)</span>
    <span class="token builtin">putStrLn</span> <span class="token operator">$</span> <span class="token string">"遍历顺序保持: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token punctuation">(</span><span class="token hvariable">inorder</span> <span class="token hvariable">tree</span> <span class="token operator">==</span> <span class="token hvariable">inorder</span> <span class="token hvariable">leftRotated</span><span class="token punctuation">)</span>
</code>
    </pre>
</div>
<h2 id="%E6%97%8B%E8%BD%AC%E6%93%8D%E4%BD%9C%E7%9A%84%E6%95%B0%E5%AD%A6%E6%80%A7%E8%B4%A8" tabindex="-1">旋转操作的数学性质</h2>
<h3 id="1.-%E4%BF%9D%E6%8C%81%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E6%80%A7%E8%B4%A8" tabindex="-1">1. 保持二叉搜索树性质</h3>
<p>旋转操作保持中序遍历的结果不变：</p>
<p><strong>定理</strong>：对于任何树 <code>T</code>，<code>inorder T = inorder (rotateLeft T) = inorder (rotateRight T)</code></p>
<p><strong>证明</strong>：
以左旋为例，设 <code>T = Node c l k (Node rc rl rk rr)</code>：</p>
<ul>
<li><code>inorder T = inorder l ++ [k] ++ inorder rl ++ [rk] ++ inorder rr</code></li>
<li><code>rotateLeft T = Node c (Node c l k rl) rk rr</code></li>
<li><code>inorder (rotateLeft T) = inorder (Node c l k rl) ++ [rk] ++ inorder rr</code></li>
<li><code>= inorder l ++ [k] ++ inorder rl ++ [rk] ++ inorder rr</code></li>
<li>因此 <code>inorder T = inorder (rotateLeft T)</code></li>
</ul>
<h3 id="2.-%E5%8F%AF%E9%80%86%E6%80%A7" tabindex="-1">2. 可逆性</h3>
<p>左旋和右旋互为逆操作：</p>
<p><strong>定理</strong>：对于可以旋转的树 <code>T</code>：</p>
<ul>
<li><code>rotateRight (rotateLeft T) = T</code></li>
<li><code>rotateLeft (rotateRight T) = T</code></li>
</ul>
<h3 id="3.-%E9%AB%98%E5%BA%A6%E5%8F%98%E5%8C%96" tabindex="-1">3. 高度变化</h3>
<p>旋转可以改变子树的高度：</p>
<ul>
<li><strong>左旋</strong>：右子树高度可能减少，左子树高度可能增加</li>
<li><strong>右旋</strong>：左子树高度可能减少，右子树高度可能增加</li>
</ul>
<p>这个性质使得旋转成为平衡树的有效工具。</p>
<h2 id="%E6%97%8B%E8%BD%AC%E5%9C%A8%E5%B9%B3%E8%A1%A1%E6%93%8D%E4%BD%9C%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8" tabindex="-1">旋转在平衡操作中的作用</h2>
<p>在红黑树中，旋转通常与重新着色结合使用：</p>
<ol>
<li><strong>LL情况</strong>：右旋解决左子树过重</li>
<li><strong>RR情况</strong>：左旋解决右子树过重</li>
<li><strong>LR情况</strong>：先左旋子树，再右旋根节点</li>
<li><strong>RL情况</strong>：先右旋子树，再左旋根节点</li>
</ol>
<p>这些模式在AVL树和红黑树的插入/删除修复中都会出现。</p>
<h2 id="%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E5%AE%9A%E4%B9%89" tabindex="-1">红黑树的定义</h2>
<p>好的，这是红黑树（Red-Black Tree）的定义和规则。</p>
<p>红黑树是一种自平衡的二叉查找树（BST）。它在二叉查找树的基础上，在每个节点上增加了一个存储位来表示节点的颜色（红色或黑色），并通过约束任何一条从根到叶子的路径上的节点颜色，来确保树保持大致平衡，从而保证在最坏情况下的查找、插入和删除操作的时间复杂度均为 O(log n)。</p>
<p>红黑树必须满足的五条性质：</p>
<ol>
<li>节点颜色特性：每个节点要么是红色，要么是黑色。</li>
<li>根节点特性：根节点必须是黑色的。</li>
<li>叶子节点（NIL）特性：所有叶子节点（NIL 节点，即空节点）都是黑色的。</li>
<li>红色节点特性：红色节点的两个子节点都必须是黑色的。（即不能有两个连续的红色节点出现在一条路径上）。</li>
<li>路径特性：从任意一个节点到其每个后代叶子节点（NIL）的所有简单路径上，包含相同数量的黑色节点。这个数量称为该节点的黑高（black height）。</li>
</ol>
<p>关键理解点：</p>
<p>· 为何能平衡：性质4和性质5共同作用，确保了从根到最远叶子的路径（可能红黑相间）不会比从根到最近叶子的路径（全黑）长过两倍。这种“大致平衡”避免了二叉查找树退化成链表的情况。
· NIL 节点：在讨论红黑树时，所有原本为 null 的子节点都被视为指向一个黑色的、不存储数据的 NIL 节点。这简化了定义，使得每个具有数据的节点都有两个子节点（虽然可能是NIL）。
· 操作与修复：当进行插入或删除操作时，可能会暂时违反这些性质。因此，需要通过重新着色和旋转（左旋和右旋）来调整树的结构，使其重新满足所有红黑树性质。这些操作是红黑树实现自平衡的核心。</p>
<p>与其他结构的对比：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>普通二叉查找树 (BST)</th>
<th>AVL 树</th>
<th>红黑树</th>
</tr>
</thead>
<tbody>
<tr>
<td>平衡性</td>
<td>可能不平衡</td>
<td>严格平衡</td>
<td>大致平衡</td>
</tr>
<tr>
<td>查询效率</td>
<td>最坏 O(n)</td>
<td>高 (O(log n))</td>
<td>高 (O(log n))</td>
</tr>
<tr>
<td>插入/删除效率</td>
<td>最坏 O(n)</td>
<td>相对较低（需要更多旋转来维持严格平衡）</td>
<td>相对较高（需要更少的旋转）</td>
</tr>
<tr>
<td>适用场景</td>
<td>不适用需要保证性能的场景</td>
<td>查询多，插入/删除少的场景（如数据库索引）</td>
<td>插入/删除操作频繁的场景（如 Linux 内核进程调度、Java HashMap、C++ STL map/set）</td>
</tr>
</tbody>
</table>
<p>总而言之，红黑树通过在节点中引入颜色属性和一套约束规则，以相对较少的维护成本（相比AVL树）换取了高效的综合性能，使其成为实践中应用非常广泛的一种数据结构。</p>
<h2 id="%E6%80%A7%E8%B4%A85%E4%BF%9D%E6%8C%81%E5%B9%B3%E8%A1%A1%E7%9A%84%E5%8E%9F%E5%9B%A0%E3%80%82" tabindex="-1">性质5保持平衡的原因。</h2>
<p>好的，这是一个非常核心的问题。红黑树的性质5之所以能保证树的“大致平衡”，关键在于它与性质4（红色节点不能连续）相结合，共同约束了最长路径的长度不会超过最短路径的两倍。</p>
<p>让我们一步步来分解这个逻辑：</p>
<ol>
<li>性质5的核心：黑高（Black Height）一致</li>
</ol>
<p>性质5规定：从任意节点到其每个后代叶子节点（NIL）的所有路径上，包含相同数量的黑色节点。</p>
<p>这意味着，对于树中的任何一个节点，你从这个节点出发，无论选择哪条路往下走到NIL叶子节点，沿途经过的黑色节点的数量都是完全一样的。这个数量被称为该节点的黑高。</p>
<p>· 整棵树的黑高就是根节点的黑高。
· 由于根节点是黑色的（性质2），所以每条从根到叶子的路径上，黑色节点的数量至少为1。</p>
<ol start="2">
<li>与性质4结合：限制路径的“膨胀”</li>
</ol>
<p>性质4规定：红色节点的两个子节点都必须是黑色的。 这保证了不会出现两个连续的红色节点。</p>
<p>现在，我们考虑从根节点到叶子节点的最短可能路径和最长可能路径：</p>
<p>· 最短路径：这条路径为了尽可能短，会尽量少包含节点。根据规则，它只能由黑色节点组成。
· 设整棵树的黑高为 bh，那么最短路径的长度就是 bh（全是黑色节点）。
· 最长路径：这条路径为了尽可能长，会在遵守规则的前提下，尽可能多地插入红色节点。根据性质4，红色节点不能连续，所以最长路径的模式必须是 黑-红-黑-红-…-黑 交替出现。
· 因为黑高是固定的 bh，所以这条路径上黑色节点的数量仍然是 bh。
· 在保证黑色节点不连续的前提下，最多可以在每两个黑色节点之间插入一个红色节点。因此，红色节点的数量最多也能达到 bh。
· 所以，最长路径的长度（总节点数）是黑色节点数 + 红色节点数 = bh + bh = 2bh。</p>
<ol start="3">
<li>结论：最长路径不会超过最短路径的两倍</li>
</ol>
<p>· 最短路径长度：bh (全黑)
· 最长路径长度：2bh (黑红交替)</p>
<p>因此，最长路径最多是最短路径长度的 2 倍。</p>
<p>这个“2倍”的约束条件，就保证了红黑树是大致平衡的。树的高度始终被维持在 O(log n) 的级别，从而使得所有基于树高的操作（查找、插入、删除）的时间复杂度最坏情况下也是 O(log n)。</p>
<hr>
<p>一个极端的例子</p>
<p>假设一棵红黑树的黑高 bh = 3。</p>
<p>· 最短路径：3 个节点（例如：根 -&gt; 黑 -&gt; 黑 -&gt; NIL）
· 最长路径：6 个节点（例如：根（黑）-&gt; 红 -&gt; 黑 -&gt; 红 -&gt; 黑 -&gt; NIL）</p>
<h2 id="%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C" tabindex="-1">插入操作</h2>
<p>红黑树的插入操作包含两个阶段：首先执行标准的二叉搜索树（BST）插入，然后通过修复操作（重新着色和旋转）来维持红黑树的性质。</p>
<h3 id="%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%89%A7%E8%A1%8C%E6%A0%87%E5%87%86bst%E6%8F%92%E5%85%A5" tabindex="-1">第一步：执行标准BST插入</h3>
<ol>
<li><strong>定位插入点</strong>：与普通二叉搜索树一样，从根节点开始，通过比较键值，找到新节点合适的插入位置。</li>
<li><strong>插入新节点</strong>：将新节点插入到指定位置。</li>
<li><strong>设置初始颜色</strong>：将新插入的节点着色为 <strong>红色</strong>。</li>
</ol>
<p><strong>为何将新节点设为红色？</strong></p>
<ul>
<li>如果设为黑色，会改变其所在路径上黑色节点的数量，直接违反性质5（黑高一致性）。修复黑高失衡非常复杂。</li>
<li>如果设为红色，不会违反性质5。它唯一可能违反的性质是性质4（红色节点的子节点必须是黑色），即当新节点的父节点也是红色时。修复“红-红”冲突相对简单。</li>
</ul>
<h3 id="%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E4%BF%AE%E5%A4%8D%E7%BA%A2%E9%BB%91%E6%A0%91%E6%80%A7%E8%B4%A8" tabindex="-1">第二步：修复红黑树性质</h3>
<p>如果新插入的红色节点 <code>z</code> 的父节点 <code>p</code> 是黑色的，那么所有性质都得以保持，无需任何操作。</p>
<p>如果父节点 <code>p</code> 也是红色的，则出现了“红-红”冲突，违反了性质4。此时，必须进行修复。由于父节点 <code>p</code> 是红色，那么它一定不是根节点，所以它必然有一个父节点，即 <code>z</code> 的祖父节点 <code>g</code>，并且 <code>g</code> 必须是黑色的。</p>
<p>修复过程是一个循环，从 <code>z</code> 开始，持续向上调整，直到“红-红”冲突被解决。在循环的每一步，我们关注当前节点 <code>z</code>、其父节点 <code>p</code>、祖父节点 <code>g</code>，以及祖父节点 <code>g</code> 的另一个子节点 <code>y</code>（通常称为叔叔节点）。</p>
<p>修复策略根据 <code>z</code> 的父节点 <code>p</code> 是 <code>g</code> 的左孩子还是右孩子分为两大类，每一类又根据 <code>y</code> 节点的颜色和 <code>z</code> 的位置分为不同情况。</p>
<hr>
<h4>A. 父节点 <code>p</code> 是祖父节点 <code>g</code> 的左孩子</h4>
<p>此时，<code>p = g.left</code>。设 <code>y = g.right</code>。</p>
<p><strong>情况 A.1: <code>y</code> 节点是红色</strong></p>
<p>此情况通过重新着色来解决。</p>
<ol>
<li>将父节点 <code>p</code> 的颜色变为 <strong>黑色</strong>。</li>
<li>将 <code>y</code> 节点的颜色变为 <strong>黑色</strong>。</li>
<li>将祖父节点 <code>g</code> 的颜色变为 <strong>红色</strong>。</li>
<li>将当前节点 <code>z</code> 指向祖父节点 <code>g</code> (<code>z = g</code>)，然后从新的 <code>z</code> 开始，继续向上进行修复（返回循环开始处）。</li>
</ol>
<p><strong>情况 A.2: <code>y</code> 节点是黑色，且 <code>z</code> 是 <code>p</code> 的右孩子 (LR-情形)</strong></p>
<p>此情况属于“内侧”插入，需要一次旋转将其转换为“外侧”插入（情况A.3）。</p>
<ol>
<li>将当前节点 <code>z</code> 指向父节点 <code>p</code> (<code>z = p</code>)。</li>
<li>对新的 <code>z</code>（即原父节点<code>p</code>）执行 <strong>左旋</strong>。</li>
<li>经过旋转，<code>z</code> 的结构转变为情况A.3，按A.3处理。</li>
</ol>
<p><strong>情况 A.3: <code>y</code> 节点是黑色，且 <code>z</code> 是 <code>p</code> 的左孩子 (LL-情形)</strong></p>
<p>此情况属于“外侧”插入，通过一次旋转和重新着色即可完成修复。</p>
<ol>
<li>将父节点 <code>p</code> 的颜色变为 <strong>黑色</strong>。</li>
<li>将祖父节点 <code>g</code> 的颜色变为 <strong>红色</strong>。</li>
<li>对祖父节点 <code>g</code> 执行 <strong>右旋</strong>。</li>
<li>修复完成，循环终止。</li>
</ol>
<hr>
<h4>B. 父节点 <code>p</code> 是祖父节点 <code>g</code> 的右孩子</h4>
<p>此情况与A类对称。此时，<code>p = g.right</code>。设 <code>y = g.left</code>。</p>
<p><strong>情况 B.1: <code>y</code> 节点是红色</strong></p>
<p>操作与情况A.1完全相同。</p>
<ol>
<li>将父节点 <code>p</code> 的颜色变为 <strong>黑色</strong>。</li>
<li>将 <code>y</code> 节点的颜色变为 <strong>黑色</strong>。</li>
<li>将祖父节点 <code>g</code> 的颜色变为 <strong>红色</strong>。</li>
<li>将当前节点 <code>z</code> 指向祖父节点 <code>g</code> (<code>z = g</code>)，继续向上修复。</li>
</ol>
<p><strong>情况 B.2: <code>y</code> 节点是黑色，且 <code>z</code> 是 <code>p</code> 的左孩子 (RL-情形)</strong></p>
<p>此情况与情况A.2对称。</p>
<ol>
<li>将当前节点 <code>z</code> 指向父节点 <code>p</code> (<code>z = p</code>)。</li>
<li>对新的 <code>z</code>（即原父节点<code>p</code>）执行 <strong>右旋</strong>。</li>
<li>经过旋转，<code>z</code> 的结构转变为情况B.3，按B.3处理。</li>
</ol>
<p><strong>情况 B.3: <code>y</code> 节点是黑色，且 <code>z</code> 是 <code>p</code> 的右孩子 (RR-情形)</strong></p>
<p>此情况与情况A.3对称。</p>
<ol>
<li>将父节点 <code>p</code> 的颜色变为 <strong>黑色</strong>。</li>
<li>将祖父节点 <code>g</code> 的颜色变为 <strong>红色</strong>。</li>
<li>对祖父节点 <code>g</code> 执行 <strong>左旋</strong>。</li>
<li>修复完成，循环终止。</li>
</ol>
<hr>
<h3 id="%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E7%A1%AE%E4%BF%9D%E6%A0%B9%E8%8A%82%E7%82%B9%E4%B8%BA%E9%BB%91%E8%89%B2" tabindex="-1">第三步：确保根节点为黑色</h3>
<p>在整个修复过程结束后，根节点可能会被标记为红色（例如在情况A.1/B.1中，问题一直上传到根部）。因此，最后必须执行一步：</p>
<ul>
<li>将树的根节点强制着色为 <strong>黑色</strong>。</li>
</ul>
<p>这确保了性质2（根节点是黑色）始终成立，并且不会影响其他性质。</p>
<h3 id="%E6%8F%92%E5%85%A5%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93" tabindex="-1">插入流程总结</h3>
<ol>
<li><strong>BST插入</strong>：将新节点作为 <strong>红色</strong> 节点插入。</li>
<li><strong>循环修复</strong>：如果 <code>z</code> 的父节点是红色，则进入循环：
<ul>
<li>根据父节点、祖父节点和其另一个子节点的位置与颜色，匹配上述 A.1, A.2, A.3 或 B.1, B.2, B.3 中的一种情况进行处理。</li>
<li>情况 A.1/B.1（对应节点的叔叔为红）会使循环继续。</li>
<li>情况 A.3/B.3（对应节点的叔叔为黑，外侧）会终止循环。</li>
<li>情况 A.2/B.2（对应节点的叔叔为黑，内侧）会转换为外侧情况后处理并终止。</li>
</ul>
</li>
<li><strong>设置根节点</strong>：将根节点设为 <strong>黑色</strong>。</li>
</ol>
<p>通过这套机制，红黑树在插入新节点后，能够通过有限次数的重新着色和旋转操作（最多两次旋转），高效地恢复平衡，确保所有操作的时间复杂度保持在 O(log n)。</p>
<h2 id="%E5%88%A0%E9%99%A4" tabindex="-1">删除</h2>
<p>好的，我们来详细地、系统地讲解红黑树的删除操作。这是一个相对复杂的过程，但我会尽量拆解，让你能清晰地理解每一步。</p>
<p>前言：为什么删除如此复杂？</p>
<p>红黑树的删除之所以比插入复杂，根本原因在于：我们实际删除的节点，可能并不是我们最初想要删除的那个键所在的节点。</p>
<p>在BST删除中，我们知道有三种情况：</p>
<ol>
<li>要删除的节点是叶子节点。</li>
<li>要删除的节点只有一个子节点。</li>
<li>要删除的节点有两个子节点。</li>
</ol>
<p>红黑树继承了这些情况，但为了维护自身的五大性质，它在删除后需要进行额外的调整（重新着色和旋转）。删除一个红色节点通常很容易，但删除一个黑色节点会破坏性质5（从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点），导致某条路径上“黑高”减少，因此需要复杂的修复。</p>
<hr>
<p>第一步：标准的BST删除</p>
<p>我们首先像在普通二叉搜索树中一样执行删除。设要删除的节点为 z。</p>
<ol>
<li>如果 z 没有子节点（是叶子节点）：直接删除它，并用 NIL 替换它的位置。</li>
<li>如果 z 只有一个子节点：删除 z，并用它的唯一子节点替换它的位置。</li>
<li>如果 z 有两个子节点：
· 找到 z 的后继（successor） 节点（即右子树中的最小节点），我们称这个后继节点为 y。
· 将 z 的键和值复制为 y 的键和值。
· 现在，问题转化为删除节点 y。注意，这个 y 节点最多只有一个子节点（因为它是最小节点，不可能有左子节点）。</li>
</ol>
<p>关键结论：无论最初要删除的节点是哪种情况，我们最终实际删除的节点（我们称之为 victim）要么是叶子节点，要么是只有一个子节点的节点。我们将重点关注这个 victim 节点的删除和后续的修复。</p>
<p>设：</p>
<p>· v：最终被删除的节点 (victim)。
· u：用来替换 v 的节点 (replacement)。如果 v 是叶子节点，u 是 NIL；如果 v 有一个子节点，u 就是那个子节点。
· p：v 的父节点。</p>
<p>执行删除：将 v 从树中移除，并用 u 替换 v 的位置（即让 p 指向 u）。</p>
<p>现在，如果 v 是红色的，那么删除它不会影响黑高，也不会违反任何性质（红色节点的子节点和父节点都是黑色，所以替换节点 u 接替它的位置不会引入连续红色等问题）。删除结束。</p>
<p>如果 v 是黑色的，问题就来了。u 现在占据了 v 的位置，但 u 的路径上少了一个黑色节点（因为 v 是黑的）。这破坏了性质5。我们把这种情况称为：节点 u 现在“双黑”了。它代表了一个额外的“黑色”重量，我们需要通过后续的修复步骤来消除这个“双黑”状态，使树重新平衡。</p>
<hr>
<p>第二步：修复“双黑”问题</p>
<p>现在，我们进入核心的修复阶段。我们假设 u 是“双黑”的（或者 u 是 NIL，也被视为“双黑”）。我们的目标是通过一系列旋转和重新着色，将这个额外的“黑色”向上传播，直到它被消除。</p>
<p>我们会根据 u 的兄弟节点 (sibling, s) 和兄弟节点的子节点以及父亲节点的颜色，分多种情况来处理。u 的位置可能是其父节点 p 的左孩子或右孩子，但情况是对称的。我们以 u 是左孩子为例进行讲解（u 是右孩子的情况完全对称）。</p>
<p>定义：</p>
<p>· u: 双黑节点（当前关注的节点）
· p: u 的父节点
· s: u 的兄弟节点（p 的另一个孩子）
· s_left (sl): 兄弟节点 s 的左孩子
· s_right (sr): 兄弟节点 s 的右孩子</p>
<p>总共有 4 种主要情况：</p>
<h3 id="%E6%83%85%E5%86%B51%EF%BC%9A%E5%85%84%E5%BC%9F-s-%E6%98%AF%E7%BA%A2%E8%89%B2" tabindex="-1">情况1：兄弟 s 是红色</h3>
<p>情况：s 是红色的。 推论：根据红黑树性质，p和 s 的子节点 (sl, sr) 必须是黑色的。</p>
<p>目标：将这种情况转换为兄弟节点是黑色的情况（情况2、3或4），因为我们对黑色兄弟节点的操作更直接。</p>
<p>操作：</p>
<ol>
<li>将兄弟节点 s 着为黑色。</li>
<li>将父节点 p 着为红色。</li>
<li>对父节点 p 进行左旋（如果 u 是左孩子）。</li>
<li>旋转后，u 有了一个新的兄弟节点（原红色兄弟 s 的左孩子 sl，这个节点是黑色的）。现在问题进入了情况2、3或4。</li>
</ol>
<p>(完成后，继续根据新的兄弟节点颜色判断属于情况2、3、4中的哪一种)</p>
<p>Before Case 1</p>
<pre><code>        P(黑)                          S(红)
       / \                           /   \
   u(双黑) S(红)      --左旋P--&gt;    P(红)   sr(黑)
          / \                      /  \
       sl(黑) sr(黑)          u(双黑) sl(黑)
</code></pre>
<p>After Case 1 (Now S is black, proceed to other cases)</p>
<hr>
<h3 id="%E6%83%85%E5%86%B52%EF%BC%9A%E5%85%84%E5%BC%9F-s-%E6%98%AF%E9%BB%91%E8%89%B2%EF%BC%8C%E4%B8%94%E5%85%84%E5%BC%9F%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%AD%A9%E5%AD%90%E9%83%BD%E6%98%AF%E9%BB%91%E8%89%B2" tabindex="-1">情况2：兄弟 s 是黑色，且兄弟的两个孩子都是黑色</h3>
<p>情况：s 是黑色的，并且 s 的两个孩子 (sl, sr) 都是黑色的。</p>
<p>目标：将“双黑”问题上推到父节点 p。我们通过将兄弟节点 s 变红来抵消 u 的“双黑”。</p>
<p>操作：</p>
<ol>
<li>将兄弟节点 s 重新着为红色。</li>
<li>此时，以 p 为根的子树黑高恢复了平衡（u 和 s 路径上的黑色节点数一致了），但 p 的父路径上可能少了一个黑色（如果 p 原来是红色的，现在它变成了新的“双黑”问题的根源；如果 p 原来是黑色的，它就变成了“双黑”）。</li>
<li>递归处理：
· 如果 p 原来是红色：直接将 p 着为黑色。修复结束！因为红色节点变成黑色，正好弥补了失去的黑色，黑高恢复。
· 如果 p 原来是黑色：那么 p 现在变成了新的“双黑”节点。我们将 u 指向 p，然后从情况1开始重新判断（即针对新的 u (p) 和它的兄弟节点等，重新开始这4种情况的判断）。</li>
</ol>
<p>Case 2</p>
<pre><code>        P(红或黑)                  P(可能双黑)
       / \                        / \
   u(双黑) S(黑)   --重着色--&gt;   u(黑) S(红)
          / \                          / \
       sl(黑) sr(黑)                sl(黑) sr(黑)
// 如果P原为红，将其变黑即可结束。
// 如果P原为黑，则P成为新的双黑节点，继续向上修复。
</code></pre>
<hr>
<h3 id="%E6%83%85%E5%86%B53%EF%BC%9A%E5%85%84%E5%BC%9F-s-%E6%98%AF%E9%BB%91%E8%89%B2%EF%BC%8C%E5%85%84%E5%BC%9F%E7%9A%84%E5%B7%A6%E5%AD%A9%E5%AD%90%E6%98%AF%E7%BA%A2%E8%89%B2%EF%BC%8C%E5%8F%B3%E5%AD%A9%E5%AD%90%E6%98%AF%E9%BB%91%E8%89%B2(%E8%BF%91%E7%82%B9)" tabindex="-1">情况3：兄弟 s 是黑色，兄弟的左孩子是红色，右孩子是黑色(近点)</h3>
<p>情况：s 是黑色的，s 的左孩子 (sl) 是红色，右孩子 (sr) 是黑色。（如果 u 是右孩子，则条件相反：兄弟的右孩子是红色，左孩子是黑色）</p>
<p>目标：将这种情况转换为情况4（兄弟的右孩子是红色）。</p>
<p>操作：</p>
<ol>
<li>将兄弟 s 的左孩子 sl 着为黑色。</li>
<li>将兄弟 s 着为红色。</li>
<li>对兄弟节点 s 进行右旋。</li>
<li>旋转后，u 有了一个新的兄弟节点（原 s 的左孩子 sl，现在这个新兄弟的右孩子是红色的 s）。现在转换成了情况4。</li>
</ol>
<p>(完成后，进入情况4处理)</p>
<p>Before Case 3 (u is left child)</p>
<pre><code>          P(?)                          P(?)
         / \                           / \
     u(双黑) S(黑)      --右旋S--&gt;   u(双黑) sl(黑)
            / \                                 \
        sl(红) sr(黑)                          S(红)
                                                 \
                                                sr(黑)
</code></pre>
<p>After Case 3 (Now ready for Case 4)</p>
<hr>
<h3 id="%E6%83%85%E5%86%B54%EF%BC%9A%E5%85%84%E5%BC%9F-s-%E6%98%AF%E9%BB%91%E8%89%B2%EF%BC%8C%E5%85%84%E5%BC%9F%E7%9A%84%E5%8F%B3%E5%AD%A9%E5%AD%90%E6%98%AF%E7%BA%A2%E8%89%B2(%E8%BF%9C%E7%82%B9)(%E8%BE%B9%E7%95%8C)" tabindex="-1">情况4：兄弟 s 是黑色，兄弟的右孩子是红色(远点)(边界)</h3>
<p>情况：s 是黑色的，s 的右孩子 (sr) 是红色。（如果 u 是右孩子，则条件是兄弟的左孩子是红色）</p>
<p>目标：这是终极情况，通过一次旋转和重新着色可以彻底解决问题。</p>
<p>操作：</p>
<ol>
<li>将兄弟节点 s 的颜色设置为父节点 p 的颜色。</li>
<li>将父节点 p 着为黑色。</li>
<li>将兄弟 s 的右孩子 sr 着为黑色。</li>
<li>对父节点 p 进行左旋。</li>
<li>移除 u 的“双黑”状态，将其着为普通的黑色。</li>
<li>修复完成。整个树的黑高恢复平衡，所有红黑树性质都得到满足。</li>
</ol>
<p>Case 4 (u is left child)</p>
<pre><code>        P(颜色C)                          S(颜色C)
       / \       &lt;-左旋P+重新着色        /   \
   u(双黑) S(黑)        ----&gt;        P(黑)   sr(黑)
          / \                       /  \
       sl(?) sr(红)             u(黑) sl(?)
// 注意：sl(?)的颜色无关紧要。旋转后，u的“双黑”被消除，树恢复平衡。
</code></pre>
<hr>
<p>总结与步骤回顾</p>
<ol>
<li>执行BST删除：找到实际要删除的节点 v（最多一个子节点）及其替换节点 u。</li>
<li>判断是否需要修复：
· 如果 v 是红色 -&gt; 结束。
· 如果 v 是黑色 -&gt; u 成为“双黑”，进入修复流程。</li>
<li>修复“双黑”节点 u：
· While u 不是根节点且 u 是“双黑”状态：
· 根据其兄弟 s 的颜色和兄弟子节点的颜色，判断属于4种情况中的哪一种。
· Case 1: 兄弟红 -&gt; 变兄弟黑，父红，旋转 -&gt; 转换为兄弟黑的情况。
· Case 2: 兄弟黑且兄弟的孩子都黑 -&gt; 兄弟变红，“双黑”问题上交给父节点 p 递归处理。
· Case 3: 兄弟黑且兄弟远侄子黑、近侄子红 -&gt; 旋转和变色，转换为Case 4。
· Case 4: 兄弟黑且兄弟远侄子红 -&gt; 旋转和变色，问题解决，退出循环。
· 最后，将 u 设为黑色（如果它是因为Case 2递归上来的普通节点，这一步确保它颜色正确；如果是从Case 4出来的，它已经被设为黑色了）。</li>
</ol>
<p>这个过程通过向上迭代或递归，最终总能将“双黑”问题解决，使树恢复所有红黑树性质。理解这4种情况以及它们之间的转换关系是掌握红黑树删除的关键。</p>

</div> 
    </div>

</article>

    </main>
    
    <footer class="site-footer">
    <div class="footer-content">
        <p>&copy; 2025 rainboy. All rights reserved. last build time 2025/11/28 15:39:46</p>
        <p class="license">内容遵循 <a style="text-decoration:none;" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
            <img decoding="async" loading="lazy" src="/ccbyncsa.png" width="65" height="auto" style="display:inline-block;">
        </a> 协议</p>
        <p class="powered-by">Powered by <a href="https://github.com/rainboyOJ/rbook_nunjucks" target="_blank"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBkPSJNMTIgMkExMCAxMCAwIDAgMCAyIDEyYzAgNC40MiAyLjg3IDguMTcgNi44NCA5LjVjLjUuMDguNjYtLjIzLjY2LS41di0xLjY5Yy0yLjc3LjYtMy4zNi0xLjM0LTMuMzYtMS4zNGMtLjQ2LTEuMTYtMS4xMS0xLjQ3LTEuMTEtMS40N2MtLjkxLS42Mi4wNy0uNi4wNy0uNmMxIC4wNyAxLjUzIDEuMDMgMS41MyAxLjAzYy44NyAxLjUyIDIuMzQgMS4wNyAyLjkxLjgzYy4wOS0uNjUuMzUtMS4wOS42My0xLjM0Yy0yLjIyLS4yNS00LjU1LTEuMTEtNC41NS00LjkyYzAtMS4xMS4zOC0yIDEuMDMtMi43MWMtLjEtLjI1LS40NS0xLjI5LjEtMi42NGMwIDAgLjg0LS4yNyAyLjc1IDEuMDJjLjc5LS4yMiAxLjY1LS4zMyAyLjUtLjMzczEuNzEuMTEgMi41LjMzYzEuOTEtMS4yOSAyLjc1LTEuMDIgMi43NS0xLjAyYy41NSAxLjM1LjIgMi4zOS4xIDIuNjRjLjY1LjcxIDEuMDMgMS42IDEuMDMgMi43MWMwIDMuODItMi4zNCA0LjY2LTQuNTcgNC45MWMuMzYuMzEuNjkuOTIuNjkgMS44NVYyMWMwIC4yNy4xNi41OS42Ny41QzE5LjE0IDIwLjE2IDIyIDE2LjQyIDIyIDEyQTEwIDEwIDAgMCAwIDEyIDIiLz48L3N2Zz4="/>
         rbook</a></p>
    </div>
</footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> 
    <script src="/assets/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/heti/0.9.6/heti-addon.min.js" integrity="sha512-GChf2qekcjrSoPicCypQLPqkaZkEnkcsJr85AmkczY0HG5SkfbxOmZY6RoFJLdoeKTGk8EZvkRBaF7BIqV1Ipw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        //const heti = new Heti('.heti');
        // error 自动挤压,增加空格 在Katex 公式中
        //heti.autoSpacing(); // 自动进行中西文混排美化和标点挤压
    </script>
</body>
</html>