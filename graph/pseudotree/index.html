<!DOCTYPE html>
<html lang="zh" data-darkmode="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的算法书 - 基环树入门</title>
    <meta name="description" content="这是一本关于算法的书">
    <meta name="author" content="rainboy">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lxgw-wenkai-web/1.520.0/style.min.css" integrity="sha512-VqbHLQtJ5icD77Z4HH8NsrtoRJlTAkOKdSrymwYZtZ1Ipbit8L/Pp8RIeHS2vpNk2bVOszUUDotVl7sK403sjw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/markdown.css">
    <link rel="stylesheet" href="/prism-theme/prism-tomorrow.css">
</head>
<body>
    <aside class="panel">
    <ul class="panel-list">
      <li><a href="/"><i class="fa fa-home"></i></a></li>
      <li><a href="javascript:void(0);" onclick="showMenuModal()"><i class="fa fa-list"></i></a></li>
    </ul>
    <ul class="panel-list">
      <li><input type="radio" class="J_darkMode" value="auto" name="darkmode" id="darkmode-auto" checked=""><label for="darkmode-auto"><i class="fa fa-adjust"></i></label></li>
      <li><input type="radio" class="J_darkMode" value="light" name="darkmode" id="darkmode-light"><label for="darkmode-light"><i class="fa fa-sun-o"></i></label></li>
      <li><input type="radio" class="J_darkMode" value="dark" name="darkmode" id="darkmode-dark"><label for="darkmode-dark"><i class="fa fa-moon-o"></i></label></li>
    </ul>
  </aside>
    <div id="modal-menu" class="modal-menu" style="display:none;">
  <div class="modal-menu-mask" onclick="hideMenuModal()"></div>
  <div class="modal-menu-content">
    <button class="modal-menu-close" onclick="hideMenuModal()">×</button>
    <h2>目录</h2>
    

<div class="chapter-list">
  
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="base">基础</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="base/double_point/index.html">双指针</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="base/binary_search/index.html">二分查找</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="base/sparse_table/index.html">ST稀疏表</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter2">第二章</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter2/chapter2-1">第一节</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter2/chapter2-2">第二节</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter3">第三章 动态规划</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128"><path fill="#c62828" d="m31.37 26.45l.17-18.43L40 5.43l9.75 16.73z"/><path fill="#37474f" d="M36.76 20.48s-2.6-11.89.34-13.07c5.23-2.09 9.31 11.65 9.31 11.65z" opacity="0.59"/><path fill="#f44336" d="M20.59 32.81c-.09-1.63-2.29-14.63 1.05-21.88c1.53-3.31 7.81-5.51 13.43-6.76c1.39-.31 4.98-.51 7.21 2.05c2.01 2.31 4.98 7.37 7.91 15l-2.11 4.54s-2.91-7.7-5.82-14.06c-2.41-5.27-5.47-3.52-5.78-2.29c-.56 2.26 2.3 14.51 2.3 14.51c-4.16 1.77-18.19 8.89-18.19 8.89"/><path fill="#455a64" d="m42.36 17.37l1.75-8.5L51 4.88l8.29.02l6.9 5.59l1.91 10.9l-8.33-2.81l-1.13-7.81l-7.64-.19l-1.02 6.21z"/><path fill="#ff7555" d="M35.06 4.18c-5.62 1.24-11.27 3.03-13.43 6.76c-1.24 2.14-1.96 7.75-1.82 12.96c1.09-1.72 5.54-4.69 8.86-6.13c3.31-1.44 3.69-2.87 3.74-3.5c.25-2.86.01-5.22.85-7.24c1.06-2.56 2.57-2.88 3.45-3.01c-.67 0-1.26.07-1.65.16m4.53.28c-.54-.19-1.08-.31-1.6-.37c.54.14 1.07.32 1.6.37"/><path fill="none" stroke="#784d30" stroke-miterlimit="10" stroke-width="9.816" d="M89.99 109.24c14.88-3.95 19.32-20.76 23.54-22.17"/><path fill="#c62828" d="M104.48 74.9c1.09 7.09 3.23 7.62 6.96 7.43c5.65-.28 6.27-1.58 7.53-11.26c1.56-12.02-2.95-28.77-6.84-40.25c-2.06-6.08-1.85-10.25-6.44-14.89c-2.52-2.55-12.33-6.3-15.18-1.42c-1.96 3.36-.98 6.77.89 9.47c5.43 7.86 10.43 33.77 13.08 50.92"/><path fill="#37474f" d="M93.06 26.91c1.04 2.13 2.11 4.89 2.98 8c8.86-.27 18.46 3.98 18.46 3.72c0-.22-.75-5.99-3.19-11.71c-1.06-2.48-4.29-9.28-8.29-8.62c-5.03.84-9.96 8.61-9.96 8.61" opacity="0.59"/><path fill="#f44336" d="M85.95 39.19c2.61-5.58 12.26-19.78 17.81-20.24c2.75-.23 5.84 5.46 6.97 8.57c3.17 8.73 6.62 22.43 7.63 36.73c.63 8.92-1 16.02-4.36 18.97c12.88-2.41 7.85-30.52 6.76-36.34c-3.67-19.49-8.48-26.84-12.17-30.77c-2.82-3-15.1-9.35-21.58-9.05c-4.99.23-15.91 9.56-18.89 14.73c-.88 1.52 17.83 17.4 17.83 17.4"/><path fill="#ff7555" d="M68.66 123.73c16.9-1.34 27.59-10.84 28.71-19.85c3.86-31.14-3.77-76.17-34.16-84.9c-3.39-.97-9.35-2.25-14.53-2.25c-6.03 0-15.33 1.27-22.01 5.85c-12.18 8.36-15.43 20.26-16.23 26.16c-2.95 21.63 36.96 76.68 58.22 74.99"/><path fill="#c62828" d="M97.37 103.88c2.01-16.2.91-36.15-4.89-52.81c-3.02-3.9-6.38-5.73-9.16-4.83c-3.34 1.08-6.27 5.53-5.21 10.01c0 0 8.09 32.46 2.59 52.99c-3.64 13.59-13.23 14.52-13.23 14.52c.4 0 .8 0 1.19-.03c16.91-1.34 27.59-10.84 28.71-19.85"/><path fill="#f44336" d="M18.62 120.38c5.1 1.61 18.51 3.62 42.26 3.62c21.33 0 21.18-7.59 22.94-16.5c3.62-18.38-1.34-78.26-38.49-79.55C12.84 26.81 9.59 45.89 7.14 66.61c-2.56 21.67-1.96 29.78-.72 38.61c1.61 11.54 8.69 14.05 12.2 15.16"/><path fill="#37474f" d="M90.05 59.81c-.86-4.52-2.08-9.49-4.09-14.34l-2.42.11c1.81 4.11 3.31 8.94 4.39 14.63c3.45 18.23 3.85 30.45 3.67 37.08c-.11 3.98 2.08 4 2.19-.25c.17-6.81-.29-18.99-3.74-37.23"/><path fill="#e2a610" d="M92.53 95.21a2.626 2.626 0 0 0-1.73 2.92l1.3 7.54a2.19 2.19 0 0 0 3.17 1.64l3.62-1.85c1.18-.6 1.56-2.11.81-3.2l-4.17-6.06a2.62 2.62 0 0 0-3-.99"/><path fill="#ffca28" d="M94.23 105.83c-.18-.33-1.14-5.47-1.43-7.81c-.32-2.63.81-2.78.98-2.92a2.62 2.62 0 0 0-2.99 3.03l1.3 7.54c.15 1.03.96 1.75 1.89 1.87c.42.05.86-.01 1.28-.23l.84-.43c-.04-.01-1.28.03-1.87-1.05"/><path fill="#546e7a" d="m119.95 92.13l-9.34.83c-.86.08-1.63-.56-1.7-1.43l-.71-7.93c-.08-.86.56-1.63 1.43-1.7l9.34-.83c.86-.08 1.63.56 1.7 1.43l.71 7.93c.07.86-.57 1.62-1.43 1.7"/><path fill="#37474f" d="m117.41 92.43l-8.84.79c-.86.08-1.63-.56-1.7-1.43l-.72-8.09c-.08-.86.56-1.63 1.43-1.7l8.84-.79c.86-.08 1.63.56 1.7 1.43l.72 8.09c.07.86-.57 1.62-1.43 1.7"/><path fill="#a06841" d="m111.28 101.56l-2.71-14.28c-.05-.24.12-.47.37-.49l7.13-.72c.2-.02.39.11.44.31l3.52 13.18c.23.86-.3 1.75-1.17 1.95l-5.68 1.3c-.87.19-1.74-.37-1.9-1.25"/><path fill="#fff59d" d="m49.47 58.81l-15.43-.46c-1.35 0-2.45-1.1-2.45-2.45l.21-7.94c0-1.33 1.06-2.42 2.39-2.45l15.26.41a2.453 2.453 0 0 1 2.52 2.4l-.03 7.99c.01 1.37-1.09 2.5-2.47 2.5" opacity="0.65"/><path fill="#ff7555" d="M87.01 7.05c-3.78.12-11.09 5.62-15.58 10.49c2.32-.19 7.81 2.38 12.37 5.9c.91.7 3.15.57 4.61-1c1.33-1.43 2.58-2.53 3.92-3.95c7.86-8.33 14.04-4.2 14.04-4.2c-6.5-4.23-14.42-7.39-19.36-7.24"/><path fill="#546e7a" d="M86.27 46.23C81.34 33.91 71.39 22.06 49.65 20.1c-15.1-1.36-25.27 5.65-29.41 8.19c-.92.56-1.95 1.26-2.65 2.22c-.89 1.22-1.01 2.22-1.01 2.22s13.1-12.23 32.87-10.48c11.3 1 26.14 4.77 34.31 23.87c.69-.17 1.62-.07 2.51.11"/><path fill="#ff7555" d="M69.35 114.25s-15.98 1.11-33.95.13c-9.47-.52-16.41-1.88-17.82-3.71c-1.74-2.26-3.8-4.45-3.8-16.07c0-7.83 2.89-14.14 8.49-14.28c4.28-.11 49.21-.6 45.82-.6s-6.45 7.43-6.14 15.44c.76 19.63 7.4 19.09 7.4 19.09"/><path fill="#ff7555" d="M53.67 94.6c.35-.1 3.53.18 6.07-1.59c.96-.67 1.72-1.23 2.33-1.87c.59-6 2.95-10.89 5.59-11.37c.09-.02.18-.04.26-.05c-3.92.08-35.97-1.1-45.98-.95c-4.64.07-8.22 5.53-7.9 11.95c.67 1.19 1.75 2.47 3.4 2.72c3.24.49 35.88 1.27 36.23 1.16"/><path fill="#fff59d" d="M53.67 94.6c.35-.1 3.53.18 6.07-1.59c.96-.67 1.72-1.23 2.33-1.87c.59-6 2.95-10.89 5.59-11.37c.09-.02.18-.04.26-.05c-3.92.08-35.97-1.1-45.98-.95c-4.64.07-8.22 5.53-7.9 11.95c.67 1.19 1.75 2.47 3.4 2.72c3.24.49 35.88 1.27 36.23 1.16" opacity="0.45"/><path fill="#c62828" d="M74.42 89.7c-.34-5.22-1.57-7.7-2.69-8.88c-1.03-1.1-2.64-1.19-4.93-1.08c-1.42.07-4.01 1.43-5.1 9.46v-.01c-.86 1.95-3.11 3.89-6.84 3.89l-35.75-1.16c-3.58-.23-4.89-3.65-5.06-3.96c0 0-.52 2.41-.03 3.94c.62 1.92 2.9 3.06 5.09 3.06l35.75 1.16c2.85 0 5.02-1.13 6.42-2.18q-.09 1.86-.09 4.05c0 15.36 4.43 16.52 7.26 16.39c2.83-.14 5.6-1.22 6.05-3.73c.64-3.51.57-10.89-.08-20.95"/></svg> </span>
              
             背包 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter3/knapsack/01-knapsack">01背包</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter3/knapsack/multiple-knapsack">多重背包</a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path fill="#00bcd4" d="M19 22h10v20H19zM32 8h10v34H32zM6 30h10v12H6z"/><g fill="#3f51b5"><path d="m11 8l10 10V8z"/><path d="m9.394 22.437l-2.828-2.828l9.969-9.969l2.828 2.828z"/></g></svg> </span>
              
             线性动态规划 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter3/linear/lcs">lcs</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="chapter3/linear/lis">lis</a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><path fill="#000" d="M16 120h480V16H16Zm32-72h416v40H48Zm192 96H16v96h224Zm-32 64H48v-32h160Zm64 32h224v-96H272Zm32-64h160v32H304Zm-152 96H16v88h136Zm-32 56H48v-24h72Zm72 32h128v-88H192Zm32-56h64v24h-64Zm136 56h136v-88H360Zm32-56h72v24h-72ZM121.442 443.278A52.721 52.721 0 1 0 68.722 496a52.78 52.78 0 0 0 52.72-52.722m-73.442 0A20.721 20.721 0 1 1 68.722 464A20.745 20.745 0 0 1 48 443.278m92.853 0a52.721 52.721 0 1 0 52.721-52.72a52.78 52.78 0 0 0-52.721 52.72m73.442 0a20.721 20.721 0 1 1-20.721-20.72a20.745 20.745 0 0 1 20.726 20.72Zm51.41 0a52.721 52.721 0 1 0 52.721-52.72a52.78 52.78 0 0 0-52.721 52.72m73.442 0a20.721 20.721 0 1 1-20.721-20.72a20.745 20.745 0 0 1 20.721 20.72m104.131-52.72A52.721 52.721 0 1 0 496 443.278a52.78 52.78 0 0 0-52.722-52.72m0 73.442A20.721 20.721 0 1 1 464 443.278A20.745 20.745 0 0 1 443.278 464"/></svg> </span>
              
             区间动态规划 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22"><path fill="currentColor" d="M7 8H5V7H4V6H3V4h6v2H8v1H7m-4 5H1v-2h2m9 2H9v-2h3m9 2h-3v-2h3M7 13H5v-1H4v-2h1V9h2v1h1v2H7m9 1h-2v-1h-1v-2h1V9h2v1h1v2h-1m2 6h-6v-2h1v-1h1v-1h2v1h1v1h1Z"/></svg> </span>
              
             动态规划优化 
            </span>
          </a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-folder-open-o"></i>
          <a href="javascript:void(0);" class="menu-no-link">第四章 数据结构</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/binary-indexed-tree">树状数组</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/segment-tree">线段树</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/stack">栈</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/stack/表达式">表达式求值</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/stack/monotonic-stack">单调栈</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/BST">二叉搜索树</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/RBTree">红黑树</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/AVL">AVL</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="data-structure/fhq-treap">FHQ-Treap</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-folder-open-o"></i>
          <a href="javascript:void(0);" class="menu-no-link">第五章 图论</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="graph/diameter_of_tree">树的直径</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="graph/center_of_tree">树的中心</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="graph/pseudotree">基环树</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="graph/kruskal">Kruskal</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="graph/floyed">floyed算法</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="string">字符串</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="string/最小表示法/index.html">最小表示法</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math">数学</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="thinkMind">思维方式</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="thinkMind/index.html">总结</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="thinkMind/约束松弛.html">约束松弛</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="thinkMind/特例化-归纳.html">特例化-归纳</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math">数学</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math/向上取整.html">向上取整</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math/log.html">对数</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math/集合.html">集合</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math/反证法.html">反证法</a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none"><path d="m12 3l4.33 6.75H7.67zM3 14h7v7H3zm18 3.5a3.5 3.5 0 1 1-7 0a3.5 3.5 0 0 1 7 0"/><path stroke="currentColor" stroke-linecap="square" stroke-width="2" d="m12 3l4.33 6.75H7.67zM3 14h7v7H3zm18 3.5a3.5 3.5 0 1 1-7 0a3.5 3.5 0 0 1 7 0Z"/></g></svg> </span>
              
             组合数学 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="math/combinatorics/112_combinatorial_problems/index.html">112个组合问题</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
      
      <li>
        
          <i class="fa fa-folder-open-o"></i>
          <a href="javascript:void(0);" class="menu-no-link">附录</a>
        

        
          
  
  <ul>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22"/></svg> </span>
              
             技巧 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/quickIO.html">quickIO</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/assert的使用.html">assert断言的使用</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/写题步奏.html">写题步奏</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/macos.html">macos下使用万能头文件</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/常用命令.html">常用命令</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/tricks/常用变量名.html">常用变量名</a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="#0065a9" d="m29.01 5.03l-5.766-2.776a1.74 1.74 0 0 0-1.989.338L2.38 19.8a1.166 1.166 0 0 0-.08 1.647q.037.04.077.077l1.541 1.4a1.165 1.165 0 0 0 1.489.066L28.142 5.75A1.158 1.158 0 0 1 30 6.672v-.067a1.75 1.75 0 0 0-.99-1.575"/><path fill="#007acc" d="m29.01 26.97l-5.766 2.777a1.745 1.745 0 0 1-1.989-.338L2.38 12.2a1.166 1.166 0 0 1-.08-1.647q.037-.04.077-.077l1.541-1.4A1.165 1.165 0 0 1 5.41 9.01l22.732 17.24A1.158 1.158 0 0 0 30 25.328v.072a1.75 1.75 0 0 1-.99 1.57"/><path fill="#1f9cf0" d="M23.244 29.747a1.745 1.745 0 0 1-1.989-.338A1.025 1.025 0 0 0 23 28.684V3.316a1.024 1.024 0 0 0-1.749-.724a1.74 1.74 0 0 1 1.989-.339l5.765 2.772A1.75 1.75 0 0 1 30 6.6v18.8a1.75 1.75 0 0 1-.991 1.576Z"/></svg> </span>
              
             vscode 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/vscode/如何调试.html">如何调试</a>
        

        

      </li>
    
      
      <li>
        
          <a href="javascript:void(0);" class="menu-info">
            <span>
              
                <span class="svg-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="#000"><path d="m3.463 12.86l-.005-.07zm7.264.69l-3.034-3.049l1.014-1.014l3.209 3.225l3.163-3.163l1.014 1.014l-3.034 3.034l3.034 3.05l-1.014 1.014l-3.209-3.225L8.707 17.6l-1.014-1.014l3.034-3.034z"/><path fill-rule="evenodd" d="M16.933 5.003V6h1.345l2.843-2.842l1.014 1.014l-2.692 2.691l.033.085a13.8 13.8 0 0 1 .885 4.912q0 .503-.034.995l-.005.075h3.54v1.434h-3.72l-.01.058c-.303 1.653-.891 3.16-1.692 4.429l-.06.094l3.423 3.44l-1.017 1.012l-3.274-3.29l-.099.11c-1.479 1.654-3.395 2.646-5.483 2.646c-2.12 0-4.063-1.023-5.552-2.723l-.098-.113l-3.209 3.208l-1.014-1.014l3.366-3.365l-.059-.095c-.772-1.25-1.34-2.725-1.636-4.34l-.01-.057H0V12.93h3.538l-.005-.075a14 14 0 0 1-.034-.995c0-1.743.31-3.39.863-4.854l.032-.084l-2.762-2.776L2.65 3.135L5.5 6h1.427v-.997a5.003 5.003 0 0 1 10.006 0m-8.572 0V6H15.5v-.997a3.569 3.569 0 0 0-7.138 0zm9.8 2.522l-.034-.09H5.733l-.034.09a12.3 12.3 0 0 0-.766 4.335c0 2.76.862 5.201 2.184 6.92c1.32 1.716 3.036 2.649 4.813 2.649s3.492-.933 4.813-2.65c1.322-1.718 2.184-4.16 2.184-6.919c0-1.574-.28-3.044-.766-4.335" clip-rule="evenodd"/></g></svg> </span>
              
             lldb的使用 
            </span>
          </a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/lldb/lldb如何调试.html">lldb如何调试</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/lldb/lldb实现display命令.html">lldb实现display命令</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/lldb/lldbinit.html">lldbinit使用</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/gdb/lldbpython脚本入门.html">lldbpython脚本入门</a>
        

        

      </li>
    
      
      <li>
        
          <i class="fa fa-file-text"></i>
          <a href="appendix/software/常用软件.html">常用软件</a>
        

        

      </li>
    
  </ul>
  

        

      </li>
    
  </ul>
  

</div>


  </div>
</div>
<script>
function showMenuModal() {
  document.getElementById('modal-menu').style.display = 'block';
}
function hideMenuModal() {
  document.getElementById('modal-menu').style.display = 'none';
}
</script>

    <main>
        
<article class="page">
    <header class="page-header">
        <h1>基环树入门</h1>
    </header>
    
    <div class="container">
        <div class="heti markdown-body">
    <nav class="table-of-contents"><ol><li><a href="#%E5%AE%9A%E4%B9%89">定义</a><ol><li><a href="#%E6%97%A0%E5%90%91%E5%9F%BA%E7%8E%AF%E6%A0%91">无向基环树</a></li><li><a href="#%E6%9C%89%E5%90%91%E5%9F%BA%E7%8E%AF%E6%A0%91">有向基环树</a><ol><li><a href="#%E5%86%85%E5%90%91%E5%9F%BA%E7%8E%AF%E6%A0%91-(in-tree)">内向基环树 (In-tree)</a></li><li><a href="#%E5%A4%96%E5%90%91%E5%9F%BA%E7%8E%AF%E6%A0%91-(out-tree)">外向基环树 (Out-tree)</a></li></ol></li></ol></li><li><a href="#%E9%80%9A%E7%94%A8%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF">通用处理思路</a></li><li><a href="#%E5%A6%82%E4%BD%95%E6%89%BE%E7%8E%AF">如何找环</a><ol><li><a href="#%E7%AE%97%E6%B3%95%E6%80%9D%E8%B7%AF">算法思路</a></li></ol></li><li><a href="#%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98">相关问题</a></li><li><a href="#topsrt%E6%89%BE%E7%8E%AF">topsrt找环</a></li><li><a href="#dfs%E6%89%BE%E7%8E%AF">dfs找环</a><ol><li><a href="#1.-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5">1. 基础概念</a></li><li><a href="#2.-%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89-if-(dfn%5Bv%5D-%3C-dfn%5Bu%5D)-continue%3B%EF%BC%9F">2. 核心问题：为什么要有 if (dfn[v] &lt; dfn[u]) continue;？</a><ol><li><a href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E7%9B%B8%E9%81%87-(%E6%B7%B1%E8%8A%82%E7%82%B9-d-%E9%81%87%E5%88%B0%E6%B5%85%E8%8A%82%E7%82%B9-a)">第一次相遇 (深节点 D 遇到浅节点 A)</a></li><li><a href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%9B%B8%E9%81%87-(%E6%B5%85%E8%8A%82%E7%82%B9-a-%E9%81%87%E5%88%B0%E6%B7%B1%E8%8A%82%E7%82%B9-d)">第二次相遇 (浅节点 A 遇到深节点 D)</a></li></ol></li><li><a href="#%E6%80%BB%E7%BB%93">总结</a></li></ol></li><li><a href="#%E5%9F%BA%E7%8E%AF%E6%A0%91%E7%9B%B4%E5%BE%84">基环树直径</a></li><li><a href="#%E5%9F%BA%E7%8E%AF%E6%A0%91%E4%B8%A4%E7%82%B9%E7%9B%B4%E6%8E%A5%E7%9A%84%E8%B7%9D%E7%A6%BB">基环树两点直接的距离</a></li><li><a href="#%E5%9F%BA%E7%8E%AF%E6%A0%91dp">基环树DP</a></li><li><a href="#%E5%8F%82%E8%80%83">参考</a></li></ol></nav><h2 id="%E5%AE%9A%E4%B9%89" tabindex="-1">定义</h2>
<p><strong>基环树</strong>（Pseudo-tree），有时也被称为环套树，是图论中的一个概念。严格来说，它并不是一棵树，而是一个包含 <strong>n 个节点</strong>和 <strong>n 条边</strong>的<strong>连通图</strong>。</p>
<p>从结构上看，一棵 n 个节点的树有 n-1 条边，如果在树上任意两个节点之间添加一条边，就会形成一个且仅有一个环。因此，基环树可以被理解为<strong>一棵树加上一条额外的边</strong>所构成的图。</p>
<p>如果图不保证连通，那么一个含有 n 个节点和 n 条边的图可能是一个<strong>基环树森林</strong>（Pseudo-forest），即由若干个基环树组成。</p>
<h3 id="%E6%97%A0%E5%90%91%E5%9F%BA%E7%8E%AF%E6%A0%91" tabindex="-1">无向基环树</h3>
<p>在无向图中，基环树的结构就是一个简单的环，环上的每个节点都可能连接着一棵或多棵子树。</p>
<figure><img src="https://img.imgdb.cn/item/6082c314d1a9ae528fd74600.png" alt="无向基环树"></figure>
<h3 id="%E6%9C%89%E5%90%91%E5%9F%BA%E7%8E%AF%E6%A0%91" tabindex="-1">有向基环树</h3>
<p>在有向图中，根据边的方向，基环树可以分为两种主要类型：</p>
<h4>内向基环树 (In-tree)</h4>
<p>每个节点都恰好有一条出边（出度为 1）。其形态表现为，所有节点最终都通过有向边汇聚到一个环上。环外的节点构成了若干棵树，树边全部指向环的方向。</p>
<figure><img src="https://img.imgdb.cn/item/6082c4d0d1a9ae528febcff3.png" alt="内向基环树"></figure>
<h4>外向基环树 (Out-tree)</h4>
<p>每个节点都恰好有一条入边（入度为 1）。其形态与内向树相反，所有边都从环开始，向外发散。环外的节点也构成若干棵树，树边全部背离环的方向。</p>
<figure><img src="https://img.imgdb.cn/item/6082c448d1a9ae528fe536d9.png" alt="外向基环树"></figure>
<h2 id="%E9%80%9A%E7%94%A8%E5%A4%84%E7%90%86%E6%80%9D%E8%B7%AF" tabindex="-1">通用处理思路</h2>
<p>处理基环树相关的问题，通常有一个经典的分析框架：</p>
<ol>
<li><strong>找到环</strong>：首先，通过算法定位图中唯一的环。</li>
<li><strong>处理子树</strong>：将环上的每个节点视为根，其向外连接的部分就构成了一棵棵独立的子树。我们可以利用树形算法（如树形 DP）对这些子树进行预处理。</li>
<li><strong>环上计算</strong>：将子树的处理结果整合到环上，再利用适用于序列或环的算法（如线性 DP、单调队列优化等）来解决整个问题。</li>
</ol>
<h2 id="%E5%A6%82%E4%BD%95%E6%89%BE%E7%8E%AF" tabindex="-1">如何找环</h2>
<p>在基环树中找到环是解决问题的第一步。最常用的方法是<strong>深度优先搜索 (DFS)</strong>。</p>
<h3 id="%E7%AE%97%E6%B3%95%E6%80%9D%E8%B7%AF" tabindex="-1">算法思路</h3>
<ol>
<li>从任意一个未访问过的节点开始进行深度优先搜索。</li>
<li>在搜索过程中，我们需要记录每个节点的父节点（即从哪个节点访问到当前节点的），同时用一个 <code>visited</code> 数组记录节点是否被访问过。</li>
<li>当从节点 <code>u</code> 访问邻接节点 <code>v</code> 时：
<ul>
<li>如果 <code>v</code> 未被访问，则继续向 <code>v</code> 深入搜索，并记 <code>parent[v] = u</code>。</li>
<li>如果 <code>v</code> <strong>已被访问</strong>过，并且 <code>v</code> <strong>不是 <code>u</code> 的父节点</strong>，那么就意味着我们找到了一个环。节点 <code>v</code> 是环的入口，而 <code>(u, v)</code> 是一条“返祖边”。</li>
</ul>
</li>
<li>找到环后，我们可以从 <code>u</code> 开始，通过 <code>parent</code> 指针不断回溯，直到再次遇到 <code>v</code>。这条回溯路径上的所有节点，再加上 <code>v</code>，就构成了基环树中的环。</li>
</ol>
<p>这个过程可以通过在 DFS 中维护一个递归栈来实现，当遇到一个已在当前递归栈中的节点时，就找到了环。</p>
<h2 id="%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98" tabindex="-1">相关问题</h2>
<p>基环树模型在算法竞赛中很常见，典型的例题包括：</p>
<ul>
<li>求基环树的直径</li>
<li>基环树上的动态规划问题</li>
<li>寻找图中距离某点最远的点</li>
</ul>
<h2 id="topsrt%E6%89%BE%E7%8E%AF" tabindex="-1">topsrt找环</h2>
<p>topsort</p>
<p>思路 : 不停的删除度为1 的点,最会剩余的点就在环上.</p>
<h2 id="dfs%E6%89%BE%E7%8E%AF" tabindex="-1">dfs找环</h2>
<p>思路:</p>
<p>容易想到</p>
<ol>
<li>记录每个的点的dfs序<code>dfn[u]</code></li>
<li>在树上dfs时,不可能遇到<code>返组边</code>,<code>已经访问过的更大dfn值的点</code></li>
<li>在基环树上 <code>返祖边</code>,<code>已经访问过的更大dfn值的点</code> 各一次,且是同一条边</li>
</ol>
<p>于是我们可以写出下面的代码</p>
<div class="language-clike line-numbers-mode">
    <div class="code-info-header">
        <span>cpp</span>
        <div class="zeroclipboard-container">
            <div class="clipboard-copy">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
                </svg>
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success">
                    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                </svg>
                copy
            </div>
        </div>
    </div>
    <pre class="language-clike">
        <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div>
        <code><span class="token comment">// loop: 存储环路上的节点,loop_cnt: 环路上的节点数量</span>
int loop<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">,</span>loop_cnt<span class="token punctuation">;</span>
<span class="token comment">// dfn: 节点在DFS过程中的访问时间戳 (discovery time)</span>
<span class="token comment">// dfn_idx: 时间戳计数器</span>
int dfn<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">,</span>dfn_idx<span class="token punctuation">;</span>
int fa<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// fa: 在DFS树中，节点的父节点</span>

<span class="token comment">/**
 * @brief 通过DFS寻找图中的环.
 * 该函数适用于有向图，它寻找由前向边构成的环.
 * @param u 当前访问的节点
 * @param father u在DFS树中的父节点
 */</span>
void <span class="token function">get_ring</span><span class="token punctuation">(</span>int u<span class="token punctuation">,</span> int father<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 为当前节点u分配一个访问时间戳</span>
    dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">++</span>dfn_idx<span class="token punctuation">;</span>
    <span class="token comment">// 记录u的父节点</span>
    fa<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> father<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> e<span class="token punctuation">.</span>h<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span> i <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        int v <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">;</span> <span class="token comment">// 邻接点</span>
        
        <span class="token comment">// 如果v已经被访问过</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dfn<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 如果v是u的祖先节点(返祖边),则跳过</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>dfn<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">&lt;</span> dfn<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// 返祖边略过</span>

            <span class="token comment">// 找到一个环: u -> v, 并且v是u的后代(前向边)</span>
            <span class="token comment">// v的时间戳比u大，说明v在u的DFS子树中</span>
            
            <span class="token comment">// 从v开始，通过父节点指针回溯到u，记录路径上的所有节点</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token punctuation">;</span> v <span class="token operator">!=</span> u <span class="token punctuation">;</span> v <span class="token operator">=</span> fa<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> loop<span class="token punctuation">[</span><span class="token operator">++</span>loop_cnt<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
            loop<span class="token punctuation">[</span><span class="token operator">++</span>loop_cnt<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token function">get_ring</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code>
    </pre>
</div>
<details><summary> 点击 </summary>
<article><p>好的，我们来详细拆解和理解这行代码 <code>if (dfn[v] &lt; dfn[u]) continue;</code> 的作用。</p>
<p>这行代码是利用深度优先搜索（DFS）在基环树中找环的关键部分。为了理解它，我们需要先明白<code>dfn</code>数组和整个DFS过程的含义。</p>
<h3 id="1.-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5" tabindex="-1">1. 基础概念</h3>
<ul>
<li><strong>基环树 (Unicyclic Graph):</strong> 一个有 N 个点、N 条边的连通图。它的结构可以看作是一棵树，上面额外多了一条边，从而形成了一个唯一的环。</li>
<li><strong>DFS (深度优先搜索):</strong> 代码中的 <code>get_loop</code> 函数本质上是一个DFS。</li>
<li><strong><code>dfn[u]</code> (Discovery Time / Timestamp):</strong> <code>dfn</code> 是 “depth-first number” 的缩写。<code>dfn[u] = ++idx;</code> 这行代码给每个节点 <code>u</code> 在DFS中被访问到的顺序打上了一个时间戳。先被访问到的节点 <code>dfn</code> 值小，后被访问到的 <code>dfn</code> 值大。</li>
<li><strong><code>fa[u]</code> (Parent):</strong> 记录在DFS树中，节点 <code>u</code> 是由哪个节点访问过来的。<code>fa[u]</code> 是 <code>u</code> 的父节点。</li>
<li><strong>找环的原理:</strong> 在DFS过程中，如果从当前节点 <code>u</code> 访问到一个邻居节点 <code>v</code>，而 <code>v</code> 之前已经被访问过了（即 <code>dfn[v]</code> 不为0），并且 <code>v</code> 不是 <code>u</code> 的父节点（<code>v != fa[u]</code>），那么我们就找到了一条“返祖边”，说明发现了一个环。</li>
</ul>
<h3 id="2.-%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89-if-(dfn%5Bv%5D-%3C-dfn%5Bu%5D)-continue%3B%EF%BC%9F" tabindex="-1">2. 核心问题：为什么要有 <code>if (dfn[v] &lt; dfn[u]) continue;</code>？</h3>
<p>在基环树的DFS中，当找到环时，实际上会有<strong>两次</strong>机会检测到这个环。</p>
<p>让我们用一个例子来说明。假设环是 <code>A - B - C - D - A</code>。我们的DFS从环外的一个点开始，通过 <code>E</code> 进入了环，访问顺序是 <code>E -&gt; A -&gt; B -&gt; C -&gt; D</code>。</p>
<p>此时的<code>dfn</code>和<code>fa</code>状态如下：</p>
<ul>
<li><code>dfn[E] &lt; dfn[A] &lt; dfn[B] &lt; dfn[C] &lt; dfn[D]</code></li>
<li><code>fa[A] = E</code>, <code>fa[B] = A</code>, <code>fa[C] = B</code>, <code>fa[D] = C</code></li>
</ul>
<p>现在，DFS到达了节点 <code>D</code>。</p>
<h4>第一次相遇 (深节点 <code>D</code> 遇到浅节点 <code>A</code>)</h4>
<ol>
<li><strong>当前节点:</strong> <code>u = D</code>。</li>
<li><strong>遍历邻居:</strong> <code>D</code> 的邻居有 <code>C</code> 和 <code>A</code>。
<ul>
<li>当邻居是 <code>C</code> 时，<code>C == fa[D]</code>，所以 <code>continue</code>，这是为了防止DFS走回头路。</li>
<li>当邻居是 <code>A</code> 时，<code>v = A</code>。</li>
</ul>
</li>
<li><strong>判断:</strong>
<ul>
<li><code>v != fa[u]</code> ( <code>A != C</code> ) -&gt; True</li>
<li><code>dfn[v]</code> ( <code>dfn[A]</code> ) &gt; 0 -&gt; True，说明 <code>A</code> 被访问过，我们找到了环！</li>
</ul>
</li>
<li><strong>进入关键代码:</strong> <code>if (dfn[v] &lt; dfn[u])</code>
<ul>
<li><code>dfn[A] &lt; dfn[D]</code> 是成立的，因为 <code>A</code> 比 <code>D</code> 先被访问。</li>
<li>所以 <code>continue</code> 被执行。</li>
<li><strong>这次相遇被忽略了！</strong></li>
</ul>
</li>
</ol>
<p>为什么忽略？因为在这个时刻，<code>A</code> 是 <code>D</code> 在DFS树中的祖先。如果我们在这里处理环，逻辑会比较复杂。而这段代码的设计者选择了一种更简洁的处理方式。</p>
<h4>第二次相遇 (浅节点 <code>A</code> 遇到深节点 <code>D</code>)</h4>
<ol>
<li>DFS从 <code>D</code> 返回，然后从 <code>C</code> 返回，从 <code>B</code> 返回，最终回到 <code>A</code>。</li>
<li><strong>当前节点:</strong> <code>u = A</code>。<code>A</code> 已经完成了对邻居 <code>B</code> 的所有深度搜索。</li>
<li><strong>遍历邻居:</strong> <code>A</code> 的邻居有 <code>E</code>, <code>B</code>, <code>D</code>。
<ul>
<li>当邻居是 <code>E</code> 时，<code>E == fa[A]</code>，<code>continue</code>。</li>
<li>当邻居是 <code>B</code> 时，对 <code>B</code> 的DFS已经完成，<code>B</code> 是 <code>A</code> 的子节点。</li>
<li>当邻居是 <code>D</code> 时，<code>v = D</code>。</li>
</ul>
</li>
<li><strong>判断:</strong>
<ul>
<li><code>v != fa[u]</code> ( <code>D != E</code> ) -&gt; True</li>
<li><code>dfn[v]</code> ( <code>dfn[D]</code> ) &gt; 0 -&gt; True，<code>D</code> 被访问过，我们又找到了环！</li>
</ul>
</li>
<li><strong>进入关键代码:</strong> <code>if (dfn[v] &lt; dfn[u])</code>
<ul>
<li><code>dfn[D] &lt; dfn[A]</code> 不成立，因为 <code>dfn[D] &gt; dfn[A]</code>。</li>
<li>所以 <code>continue</code> 不被执行。</li>
</ul>
</li>
<li><strong>执行找环逻辑:</strong>
<ul>
<li><code>loop[++cnt] = v;</code> // <code>D</code> 被加入环</li>
<li><code>for (; v != u; v = fa[v])</code> // 从 <code>D</code> 开始，通过 <code>fa</code> 指针往回走
<ul>
<li><code>v=D</code>, <code>fa[D]=C</code>。<code>C</code> 被加入环。</li>
<li><code>v=C</code>, <code>fa[C]=B</code>。<code>B</code> 被加入环。</li>
<li><code>v=B</code>, <code>fa[B]=A</code>。<code>A</code> 被加入环。</li>
<li><code>v</code> 变成 <code>A</code>，循环条件 <code>v != u</code> ( <code>A != A</code> ) 为假，循环结束。</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>此时，环上的所有节点 (<code>D</code>, <code>C</code>, <code>B</code>, <code>A</code>) 都被正确地找到了。</p>
<h3 id="%E6%80%BB%E7%BB%93" tabindex="-1">总结</h3>
<p>这行代码 <code>if (dfn[v] &lt; dfn[u]) continue;</code> 是一个巧妙的<strong>过滤器</strong>。</p>
<p>它的核心思想是：<strong>只在环上<code>dfn</code>值最小的那个节点（也就是DFS最先进入环的那个节点）去处理和记录整个环。</strong></p>
<ul>
<li><strong><code>dfn[v] &lt; dfn[u]</code> 的情况:</strong>
<ul>
<li>这表示当前节点 <code>u</code> 找到了一个它的祖先 <code>v</code>，形成了一个环。</li>
<li>我们选择<strong>忽略</strong>这次发现，让DFS继续回溯。</li>
</ul>
</li>
<li><strong><code>dfn[v] &gt; dfn[u]</code> 的情况:</strong>
<ul>
<li>这表示当前节点 <code>u</code> (一个祖先) 找到了一个它的后代 <code>v</code>，而这个后代 <code>v</code> 之前已经被访问过了（说明 <code>u</code> 和 <code>v</code> 在同一个环上，并且 <code>v</code> 是通过另一条路径被访问的）。</li>
<li><code>u</code> 就是这个环上<code>dfn</code>值最小的节点。</li>
<li>这时，我们才开始执行找环的逻辑。因为从 <code>v</code> 到 <code>u</code> 的路径已经通过 <code>fa</code> 数组完整地记录下来了，可以方便地回溯并记录所有环上的节点。</li>
</ul>
</li>
</ul>
<p>通过这种方式，可以保证环只被发现和处理<strong>一次</strong>，并且是在一个最方便处理的位置（环的“顶部”），使得代码逻辑变得非常清晰和简单。</p>
</article></details>
<p>代码</p>
<p>dfs</p>
<p>思路</p>
<p>代码</p>
<h2 id="%E5%9F%BA%E7%8E%AF%E6%A0%91%E7%9B%B4%E5%BE%84" tabindex="-1">基环树直径</h2>
<h2 id="%E5%9F%BA%E7%8E%AF%E6%A0%91%E4%B8%A4%E7%82%B9%E7%9B%B4%E6%8E%A5%E7%9A%84%E8%B7%9D%E7%A6%BB" tabindex="-1">基环树两点直接的距离</h2>
<h2 id="%E5%9F%BA%E7%8E%AF%E6%A0%91dp" tabindex="-1">基环树DP</h2>
<h2 id="%E5%8F%82%E8%80%83" tabindex="-1">参考</h2>
<ul>
<li><a href="https://www.luogu.com.cn/article/0i6swvk6">https://www.luogu.com.cn/article/0i6swvk6</a></li>
<li><a href="https://entiesci.github.io/oi-beats/site/%E5%9B%BE%E8%AE%BA/%E5%9F%BA%E7%8E%AF%E6%A0%91/">https://entiesci.github.io/oi-beats/site/图论/基环树/</a></li>
</ul>

</div> 
    </div>

</article>

    </main>
    
    <footer class="site-footer">
    <div class="footer-content">
        <p>&copy; 2025 rainboy. All rights reserved. last build time 2025/11/28 15:39:46</p>
        <p class="license">内容遵循 <a style="text-decoration:none;" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
            <img decoding="async" loading="lazy" src="/ccbyncsa.png" width="65" height="auto" style="display:inline-block;">
        </a> 协议</p>
        <p class="powered-by">Powered by <a href="https://github.com/rainboyOJ/rbook_nunjucks" target="_blank"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBkPSJNMTIgMkExMCAxMCAwIDAgMCAyIDEyYzAgNC40MiAyLjg3IDguMTcgNi44NCA5LjVjLjUuMDguNjYtLjIzLjY2LS41di0xLjY5Yy0yLjc3LjYtMy4zNi0xLjM0LTMuMzYtMS4zNGMtLjQ2LTEuMTYtMS4xMS0xLjQ3LTEuMTEtMS40N2MtLjkxLS42Mi4wNy0uNi4wNy0uNmMxIC4wNyAxLjUzIDEuMDMgMS41MyAxLjAzYy44NyAxLjUyIDIuMzQgMS4wNyAyLjkxLjgzYy4wOS0uNjUuMzUtMS4wOS42My0xLjM0Yy0yLjIyLS4yNS00LjU1LTEuMTEtNC41NS00LjkyYzAtMS4xMS4zOC0yIDEuMDMtMi43MWMtLjEtLjI1LS40NS0xLjI5LjEtMi42NGMwIDAgLjg0LS4yNyAyLjc1IDEuMDJjLjc5LS4yMiAxLjY1LS4zMyAyLjUtLjMzczEuNzEuMTEgMi41LjMzYzEuOTEtMS4yOSAyLjc1LTEuMDIgMi43NS0xLjAyYy41NSAxLjM1LjIgMi4zOS4xIDIuNjRjLjY1LjcxIDEuMDMgMS42IDEuMDMgMi43MWMwIDMuODItMi4zNCA0LjY2LTQuNTcgNC45MWMuMzYuMzEuNjkuOTIuNjkgMS44NVYyMWMwIC4yNy4xNi41OS42Ny41QzE5LjE0IDIwLjE2IDIyIDE2LjQyIDIyIDEyQTEwIDEwIDAgMCAwIDEyIDIiLz48L3N2Zz4="/>
         rbook</a></p>
    </div>
</footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> 
    <script src="/assets/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/heti/0.9.6/heti-addon.min.js" integrity="sha512-GChf2qekcjrSoPicCypQLPqkaZkEnkcsJr85AmkczY0HG5SkfbxOmZY6RoFJLdoeKTGk8EZvkRBaF7BIqV1Ipw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        //const heti = new Heti('.heti');
        // error 自动挤压,增加空格 在Katex 公式中
        //heti.autoSpacing(); // 自动进行中西文混排美化和标点挤压
    </script>
</body>
</html>