---
oj: "luogu"
problem_id: "P4951"
title: "[USACO01OPEN] Earthquake"
date: 2026-01-05 14:06
toc: true
tags: []
desc: ""
source: https://www.luogu.com.cn/problem/P4951
---

[[TOC]]

## 题目解析

这道题目是一个非常经典的**0/1分数规划（0/1 Fractional Programming）**问题，结合了**最小生成树（MST）**的知识。

### 1. 题目分析

我们需要选择一组边，使得这组边构成一个生成树（保证所有牧场连通），并且最大化以下目标函数：

$$\text{Answer} = \frac{\text{总利润}}{\text{总时间}} = \frac{F - \sum c_i}{\sum t_i}$$

其中：

- $F$ 是约翰支付的总金额（固定值）。
- $\sum c_i$ 是所选道路的总成本。
- $\sum t_i$ 是所选道路的总施工时间。

### 2. 数学推导 (分数规划二分法)

我们假设存在一个答案 $x$，使得：



$$\frac{F - \sum c_i}{\sum t_i} \ge x$$

因为时间 $\sum t_i$ 肯定是正数，我们可以将分母乘过去（不等号方向不变）：



$$F - \sum c_i \ge x \cdot \sum t_i$$

移项整理：



$$F \ge \sum c_i + x \cdot \sum t_i$$

$$F \ge \sum (c_i + x \cdot t_i)$$

这个不等式的含义是：

如果我们要检查是否存在一个比率 $x$，我们需要判断是否能找到一组边（构成生成树），使得这组边的 “新权值” 之和小于等于 $F$。

这里的“新权值”定义为：对于每一条边 $i$，它的权值 $w_i = c_i + x \cdot t_i$。

### 3. 算法设计

根据上面的推导，我们可以确定解题策略：**二分答案 + 最小生成树**。

1. **二分范围**：
   - 下界 $L = 0$（题目要求如果无利可图输出 0.0000）。
   - 上界 $R$：由于 $F$ 最大为 $2 \times 10^9$，时间最小为 1，理论上最大值可能很大，可以设为一个足够大的数（比如 $2 \times 10^9$ 或者 $10^9$ 即可，实际上由于 $c_i \ge 1$，且至少 $N-1$ 条边，上界设为 $F$ 也是安全的）。
2. **Check 函数 (`check(x)`)**：
   - 对于给定的 $x$，重新计算每条边的权值：$w_i = c_i + x \cdot t_i$。
   - 使用 **Kruskal** 或 **Prim** 算法求出当前新权值下的**最小生成树（MST）**的总权值 $Sum$。
   - 判断 $F \ge Sum$。
     - 如果成立，说明我们花费的代价比 $F$ 小（或者相等），意味着利润还能更高（或者分母可以更小），所以尝试更大的 $x$ ($L = mid$)。
     - 如果不成立，说明这个比率 $x$ 太高了，导致总成本（含时间折算）超过了 $F$，需要减小 $x$ ($R = mid$)。
3. **为什么是生成树？**
   - 因为边权 $c_i$ 和 $t_i$ 都是正数，如果不构成树而包含了环，或者选了多余的边，只会增加 $\sum c_i$ 和 $\sum t_i$，从而导致分子 $(F - \sum c_i)$ 变小，分母变大，总比值一定变小。所以最优解一定是一个边数最少的连通图，即生成树。

### 4. 代码实现

使用 Kruskal 算法来实现 MST。


@include-code(./1.cpp, cpp)



### 5. 复杂度分析

- **时间复杂度**：
  - 二分循环次数固定为 $K$ (例如 100 次)。
  - 每次 `check` 内部包含一次排序和一次并查集遍历。
  - 排序复杂度：$O(M \log M)$。
  - 并查集复杂度：$O(M \alpha(N))$，接近线性。
  - 总复杂度：$O(K \cdot M \log M)$。
  - 代入数据：$100 \times 10000 \times 14 \approx 1.4 \times 10^7$，在通常 1秒 ($10^8$ 次运算) 的时限内非常安全。
- **空间复杂度**：
  - 存储边 $O(M)$，并查集 $O(N)$。

### 6. 注意事项

1. **精度问题**：二分浮点数时，推荐使用固定次数循环（如 `for(int i=0; i<100; i++)`）而不是 `while(r-l > eps)`，这样可以避免死循环并确保精度足够。
2. **数据类型**：虽然 $N, M$ 是整数，但 $F$ 和计算过程中的权值涉及比率，必须使用 `double`。
3. **负利润处理**：题目说如果无利可图输出 `0.0000`。我们的二分下界设为 0，如果连 $x=0$ 都不满足（即 $\sum c_i > F$），二分会自动收敛到 0，符合题意。


