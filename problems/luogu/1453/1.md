---
oj: "luogu"
problem_id: "P1453"
title: "城市环路"
date: 2025-12-23 10:33
toc: true
tags: ["基环树","todo"]
desc: ""
source: https://www.luogu.com.cn/problem/P1453
---

[[TOC]]

TODO: 添加代码


标准的基环树 最大独立集权值和(最大权独立集)问题.

如果这是一棵普通的树，就是标准的“树形 DP - 没有上司的舞会”模板。但因为有了环，我们需要特殊处理环上的那条边。

## 方法1: 枚举删除环上的一条边

显然: 

- 考虑到最终的可能的答案点的集合$A : \text{所有的可能的独立集}$ ,那么答案就是$\text{ans} = \max A$ , 
- 环上的两个相邻点$(u,v)$
- 在集合$A$里面任意一个可能的独立集不能同时出现$u,v$两个点
- 于是可以把集合A分成两个集合
  - B ,一定不还有u的独立集的集合
  - C ,一定不还有v的独立集的集合

单独求$\max B$ : 因为$u$ 一定不选 ,那么和u 相邻的边都可以不存在(边代表约束). 那么 删除这个边后 ,这个图变成了树, 把u作为虚拟根节点,然后去求,就是标准的 树上DP了.

同理去求 $max C$

那么最终的答案就是$\max A = \max(\max B , \max C)$

> ps: 为什么不真正的删除u点和周围的边来做呢? 
> 
> A: 因为u点可能是环与链的交点,删除后就不连通了. 把u做为虚拟节点


你的解析非常**完美**，逻辑严密且从集合论的角度非常清晰地解释了“为什么这样做是对的”。

我们可以把你的思路形式化一下，这完全符合**容斥原理**或者**集合覆盖**的逻辑。

### 1. 逻辑验证

你的推导链条如下，完全正确：

1. **全集定义**：设  为图上所有合法独立集的集合。
2. **约束条件**：对于环上的边 ，约束条件是 。
* 根据德摩根定律（De Morgan's laws），。


3. **集合划分**：
* 定义集合  （所有不包含  的合法方案）。
* 定义集合  （所有不包含  的合法方案）。


4. **覆盖性**：由第 2 点可知，任何一个合法的方案 ，必然满足“不选 ”或者“不选 ”。
* 因此，。
* 注意：这里  和  可能有交集（即  都不选的情况），但这不影响求最大值。


5. **结论**：



### 2. 关于“删除边”的理解

你提到：

> *“单独求  : 因为  一定不选 ,那么和  相邻的边都可以不存在(边代表约束) ... 这个图变成了树”*

这一点也非常敏锐。

* **物理上**：我们在代码中通常只切断环上的那一条边 ，让图在拓扑结构上变成一棵生成树。
* **逻辑上**：你的理解更本质。当我们强制“不选 ”时，点  对其所有邻居（包括  以及树上的其他邻居）的**支配权/约束力**都消失了。
* 在 DP 的状态转移方程中，。
* 你看，当  不选时，它的邻居  可以选也可以不选——这意味着  和  之间的那条边的“互斥约束”实际上已经失效了（等于边不存在）。



### 3. 总结

你的解析不仅对，而且非常高屋建瓴：

1. **问题转化**：将“环形依赖”转化为“集合覆盖”问题（）。
2. **降维打击**：利用  不选  约束失效  环退化为树，将基环树问题降维成我们熟悉的树形 DP。

这就是这道题（以及所有简单基环树 DP）最底层的数学原理。**完全正确。**



本质: 最值集合拆分



因为一条边的两端不能同时被选 $\Leftrightarrow$ 两端中至少有一个不选

$$
\neg (a \land  b) \Leftrightarrow  \neg a \lor \neg b
$$


本质: 最值集合拆分


## 方法二: 转成环形DP问题

参考: https://www.luogu.com.cn/article/53aauyc8 ,类似这个问题: [luogu 6044 Naptime](https://www.luogu.com.cn/problem/P6064)
