---
oj: "luogu"
problem_id: "P6583"
title: "å›é¦–è¿‡å»"
date: 2025-12-17 09:02
toc: true
tags: ["æ•°è®º","å®¹æ–¥åŸç†","æ•´é™¤åˆ†å—"]
desc: ""
source: https://www.luogu.com.cn/problem/P6583
---

[[TOC]]


## 1 é¢˜ç›®ç®€è¿°

**é¢˜ç›®**ï¼šç»™å®šæ­£æ•´æ•° $n$ ($1 \le n \le 10^{12}$)ï¼Œæ±‚å‡ºæœ‰åºæ•´æ•°å¯¹ $(x,y)$ çš„ä¸ªæ•°ï¼Œæ»¡è¶³ $1\le x,y\le n$ ä¸” $\frac{x}{y}$ å¯ä»¥è¡¨ç¤ºä¸ºåè¿›åˆ¶æœ‰é™å°æ•°ã€‚

**æ ¸å¿ƒéš¾ç‚¹**ï¼šæ•°æ®è§„æ¨¡é«˜è¾¾ $10^{12}$ï¼Œæ™®é€šçš„ $O(n)$ æš´åŠ›æšä¸¾æ˜¾ç„¶ä¼šè¶…æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ¨å¯¼å‡ºä¸€ä¸ª $O(\sqrt{n})$ æˆ–æ›´ä¼˜çš„æ•°è®ºè§£æ³•ã€‚

## 2 æ•°å­¦æ¨å¯¼

### æœ‰é™å°æ•°çš„æ€§è´¨

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼šä¸€ä¸ªæœ€ç®€åˆ†æ•° $\frac{A}{B}$ èƒ½åŒ–ä¸ºæœ‰é™å°æ•°ï¼Œå½“ä¸”ä»…å½“åˆ†æ¯ $B$ çš„è´¨å› å­åªåŒ…å« **2** å’Œ **5**ã€‚

æ ¹æ®ä¸Šé¢çš„æ€§è´¨,æˆ‘ä»¬å†™äº†ä¸€ä¸ªæœ€æœ´ç´ çš„æš´åŠ›æšä¸¾ 

### ä»£ç 1

::: fold

@include-code(./b1.cpp, cpp)

:::

å¯¹äºé¢˜ç›®ä¸­çš„åˆ†æ•° $\frac{x}{y}$ï¼ˆå¯èƒ½æœªåŒ–ç®€ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†åˆ†æ¯ $y$ åˆ†è§£ä¸ºä¸¤éƒ¨åˆ†ï¼š
$$y = k \times z$$
å…¶ä¸­ï¼š

  * $z$ æ˜¯ $y$ ä¸­åªåŒ…å«å› å­ 2 å’Œ 5 çš„éƒ¨åˆ†ï¼ˆå³ $z = 2^a \times 5^b$ï¼‰ã€‚
  * $k$ æ˜¯ $y$ å»é™¤ 2 å’Œ 5 å› å­åå‰©ä¸‹çš„éƒ¨åˆ†ï¼Œæ­¤æ—¶å¿…ç„¶æ»¡è¶³ $\gcd(k, 10) = 1$ã€‚

### æ¶ˆé™¤å› å­ k

ä¸ºäº†è®© $\frac{x}{y} = \frac{x}{k \times z}$ æˆä¸ºæœ‰é™å°æ•°ï¼Œåˆ†å­ $x$ å¿…é¡»èƒ½å¤Ÿçº¦æ‰åˆ†æ¯ä¸­çš„ $k$ã€‚è¿™æ„å‘³ç€ $x$ å¿…é¡»æ˜¯ $k$ çš„å€æ•°ã€‚
å³ $x = c \times k$ã€‚

### ä»£ç 2

å¦‚æœæˆ‘ä»¬å›ºå®š$y$,é‚£ä¹ˆå°±å¯ä»¥æ±‚å‡ºå¯¹åº”çš„$k$,yå»é™¤å› å­2å’Œ5,å¾—åˆ°k,é‚£ä¹ˆä¸ä¹‹å¯¹åº”çš„xæœ‰å¤šå°‘ä¸ªå‘¢? å°±æ˜¯é—®$n$å†…æœ‰å¤šå°‘ä¸ªæ•°å­—æ˜¯kçš„å€æ•°,$\lfloor \frac{n}{k} \rfloor$

$$
Ans = \sum_y^n (\lfloor  \frac{n}{k} \rfloor) , \text{kç”±yå¾—åˆ°}
$$


å†™å‡ºç¬¬äºŒä¸ªä»£ç ,æ—¶é—´,æ¥è¿‘$O(n)$

::: fold

@include-code(./b2.cpp, cpp)

:::


### è®¡æ•°è½¬åŒ–

![](./1.excalidraw.svg)

ä¸€ä¸ªyå¯¹åº”ä¸€ä¸ªk,ä½†æ˜¯kå¯èƒ½å¯¹åº”å¤šä¸ªy. æ—¢ç„¶æšä¸¾yä¸è¡Œ,é‚£æˆ‘ä»¬è½¬è€Œå»æšä¸¾$k$

æˆ‘ä»¬å¯ä»¥æ”¹å˜æšä¸¾å¯¹è±¡ï¼šä¸æšä¸¾ $y$ï¼Œè€Œæ˜¯**æšä¸¾ $k$**ã€‚
å¯¹äºä¸€ä¸ªå›ºå®šçš„ $k$ï¼ˆæ»¡è¶³ $\gcd(k, 10) = 1$ï¼‰ï¼š

1.  **$x$ çš„é™åˆ¶**ï¼šå› ä¸º $1 \le x \le n$ ä¸” $k|x$ï¼Œæ‰€ä»¥åˆæ³•çš„ $x$ æœ‰ $\lfloor \frac{n}{k} \rfloor$ ä¸ªã€‚
2.  **$y$ çš„é™åˆ¶**ï¼šå› ä¸º $y = k \times z \le n$ï¼Œæ‰€ä»¥ $z \le \lfloor \frac{n}{k} \rfloor$ã€‚ä¸” $z$ å¿…é¡»å½¢å¦‚ $2^a \times 5^b$ã€‚
      * è®¾å‡½æ•° $f(m)$ è¡¨ç¤º $\le m$ çš„æ•°ä¸­å½¢å¦‚ $2^a \times 5^b$ çš„æ•°çš„ä¸ªæ•°ã€‚
      * é‚£ä¹ˆåˆæ³•çš„ $y$ å°±å¯¹åº”ç€ $f(\lfloor \frac{n}{k} \rfloor)$ ä¸ªåˆæ³•çš„ $z$ã€‚

ç»¼åˆä¸Šè¿°ä¸¤ç‚¹ï¼Œæ€»ç­”æ¡ˆä¸ºï¼š
$$\text{Ans} = \sum_{k=1, \gcd(k,10)=1}^{n} \left( \lfloor \frac{n}{k} \rfloor \times f\left(\lfloor \frac{n}{k} \rfloor\right) \right)$$

ä¸¾ä¸ªä¾‹å­: å½“$n=7$,kä¸åŒçš„æ—¶å€™:`1 3 7`,å¯¹åº”çš„x,yåˆ†åˆ«
```
k = 1
cnt x = 1 2 3 4 5 6 7
cnt y = 1 2 4 5

k = 3
cnt x = 3 6
cnt y = 3 6

k = 7
cnt x = 7
cnt y = 7
```


æˆ‘ä»¬å†™å‡ºä¸€ä¸ªæš´åŠ›çš„æšä¸¾k,ç„¶åè¾“å‡ºæ–¹æ¡ˆçš„ä»£ç 

::: fold

@include-code(./b3.cpp, cpp)

:::

### 3 æ±‚få‡½æ•°

å¦‚ä½•æ±‚$f\left(\lfloor \frac{n}{k} \rfloor = m\right)$ ? è®¾å‡½æ•° $f(m)$ è¡¨ç¤º $[1, m]$ çš„æ•°ä¸­å½¢å¦‚ $2^a \times 5^b$ çš„æ•°çš„ä¸ªæ•°ã€‚

åªè€ƒè™‘$2^a$,é‚£ä¹ˆå°±æœ‰$log_2n$,æ‰€æœ‰å¯ä»¥çŸ¥é“,a,bçš„æ•°é‡ä¸æ˜¯å¾ˆå¤§


```python
>>> import math
>>> math.log2(10**12)
39.86313713864835
>>> 2 ** 40 > 10 ** 12
True
>>> 2 ** 39 > 10 ** 12
False
>>> 2 ** 39 >= 10 ** 12
False
>>> math.log(10**12,5)
17.16811869688072
```

æ‰€æœ‰æˆ‘ä»¬ç›´æ¥æšä¸¾å°±å¯ä»¥äº†

::: fold

@include-code(./b4.cpp, cpp)

:::

## 4 ç®—æ³•å®ç°ä¸ä¼˜åŒ–

ç›´æ¥è®¡ç®—ä¸Šè¿°å…¬å¼ä»ç„¶æ˜¯ $O(n)$ çš„ã€‚ä¸ºäº†é€šè¿‡ $10^{12}$ çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ **æ•´é™¤åˆ†å— (Number Theory Blocking)**ã€‚

> ç°åœ¨ä¸Šé¢çš„ä»£ç çš„é—®é¢˜: å°±åœ¨äºkè¿˜æ˜¯éœ€è¦ä¸€ä¸ªä¸€ä¸ªæšä¸¾å‡ºæ¥

> æˆ‘ä»¬å‘ç°ä¸€ä¸ªé‡è¦çš„è§„å¾‹: å½“kå¢é•¿çš„æ—¶å€™, `n/k` çš„å˜æ¢æ˜¯æ¢¯åº¦ä¸‹é™çš„

```hs
import Data.List

main = do
    let n = 30
    let a = [ n `div` i | i <-[1..n]  ]
    putStrLn $ show a
```

```bash
âœ  6583 git:(main) âœ— runghc 1.hs
[30,15,10,7,6,5,4,3,3,3,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
```

åŒä¸€å—å†…çš„å…ƒç´ çš„`n/k`çš„å€¼æ˜¯ä¸€æ ·çš„. é‚£ä¹ˆé…åˆ`g`å‡½æ•°(åœ¨ä¸‹é¢ğŸ‘‡),å¯ä»¥å¿«é€Ÿçš„æ±‚å‡ºä¸€å—å†…åˆæ³•çš„æ•°å€¼(`gcd(i,10) = 1`)çš„æ•°é‡ 

æ•´é™¤åˆ†å—çš„ä»£ç 

```cpp
```

### ä¼˜åŒ– 1ï¼šæ•´é™¤åˆ†å—

è§‚å¯Ÿå‘ç°ï¼Œ$\lfloor \frac{n}{k} \rfloor$ çš„å€¼å‘ˆé˜¶æ¢¯çŠ¶ä¸‹é™ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ $\lfloor \frac{n}{k} \rfloor$ å€¼ç›¸åŒçš„ $k$ å½’ä¸ºä¸€ä¸ªåŒºé—´ $[l, r]$ ç»Ÿä¸€è®¡ç®—ã€‚

  * åŒºé—´å³ç«¯ç‚¹è®¡ç®—ï¼š$r = n / (n / l)$ã€‚
  * åŒºé—´è´¡çŒ®ï¼š
    $$
    (\text{åŒºé—´å†…ä¸10äº’è´¨çš„æ•°}) \times (\lfloor \frac{n}{l} \rfloor \times f(\lfloor \frac{n}{l} \rfloor))
    $$

### ä¼˜åŒ– 2ï¼šå¿«é€Ÿè®¡ç®—äº’è´¨ä¸ªæ•°

å¦‚ä½•å¿«é€Ÿæ±‚åŒºé—´ $[l, r]$ å†…ä¸ 10 äº’è´¨çš„æ•°çš„ä¸ªæ•°ï¼Ÿ
åˆ©ç”¨å‰ç¼€å’Œæ€æƒ³ï¼š`count(r) - count(l-1)`ã€‚
ç”±äºä¸ 10 äº’è´¨çš„åˆ†å¸ƒå…·æœ‰å‘¨æœŸæ€§ï¼ˆå‘¨æœŸä¸º 10ï¼Œäº’è´¨æ•°ä¸º 1, 3, 7, 9ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ $O(1)$ ç®—å‡ºï¼š
$$\text{count}(x) = (x / 10) \times 4 + \text{check}(x \% 10)$$


æ–¹æ³•äºŒ: å®¹æ–¥åŸç†

å¦‚æœè¦æ±‚$i \in [1,n],\sum_1^n 1(gcd(i,10))$, å¯ä»¥ä½¿ç”¨å®¹æ–¥åŸç† 

- $A$ è¡¨ç¤º2çš„å€æ•°
- $B$ è¡¨ç¤º5çš„å€æ•°
- $n - | A \cup B|$,å¦‚ä½•æ±‚$| A \cup B|$?
- $| A \cup B| = |A| + |B| - |A \cap B|$
- $|A| =\lfloor \frac{n}{2} \rfloor$
- $|B| =\lfloor \frac{n}{5} \rfloor$
- $|A \cap B| =\lfloor \frac{n}{10} \rfloor$

äºæ˜¯å¯ä»¥å†™å‡ºä»£ç 


```cpp
ll g(ll n) {
    return n - n/2 - n/5 + n/10;
}
```

### ä¼˜åŒ– 3ï¼šé¢„å¤„ç† f(v)

$f(v)$ éœ€è¦ç»Ÿè®¡ $\le v$ çš„ $2^a \times 5^b$ çš„æ•°é‡ã€‚
ç”±äº $n \le 10^{12}$ï¼Œæ»¡è¶³æ¡ä»¶çš„æ•°å¹¶ä¸å¤šï¼ˆå‡ ç™¾ä¸ªï¼‰ã€‚æˆ‘ä»¬å¯ä»¥é¢„å…ˆç”Ÿæˆæ‰€æœ‰ $2^a \times 5^b \le 10^{12}$ çš„æ•°ï¼Œå­˜å…¥æ•°ç»„å¹¶æ’åºã€‚
è®¡ç®— $f(v)$ æ—¶ï¼Œåªéœ€ä½¿ç”¨ `std::upper_bound` è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾å³å¯ã€‚

## 4 C++ ä»£ç å‚è€ƒ

æˆ‘çš„ä»£ç 

@include-code(./1.cpp,cpp)


æ²¡æœ‰ä½¿ç”¨å®¹æ–¥åŸç†çš„ä»£ç .

```cpp
#include <iostream>
#include <vector>
#include <algorithm>

using namespace std;

typedef long long ll;

ll n;
vector<ll> nums; // å­˜å‚¨æ‰€æœ‰ 2^a * 5^b

// é¢„å¤„ç†æ‰€æœ‰ <= 10^12 çš„ 2^a * 5^b
void init() {
    // 2^40 > 10^12, 5^18 > 10^12ï¼ŒèŒƒå›´å¾ˆå°
    for (ll i = 1; i <= n; i *= 2) {
        for (ll j = i; j <= n; j *= 5) {
            nums.push_back(j);
        }
    }
    sort(nums.begin(), nums.end());
}

// è®¡ç®— 1 åˆ° x ä¹‹é—´ä¸ 10 äº’è´¨çš„æ•°çš„ä¸ªæ•°
ll count_coprime(ll x) {
    ll cycle = x / 10;
    ll rem = x % 10;
    // å‘¨æœŸå†…äº’è´¨ä¸ªæ•°ä¸º 4 (1, 3, 7, 9)
    ll ans = cycle * 4;
    
    // å¤„ç†ä½™æ•°éƒ¨åˆ†
    // a æ•°ç»„å¯¹åº” 0-9 èŒƒå›´å†…ä¸ 10 äº’è´¨æ•°çš„ç´¯ç§¯ä¸ªæ•°
    static int a[10] = {0, 1, 1, 2, 2, 2, 2, 3, 3, 4};
    ans += a[rem];
    
    return ans;
}

// è®¡ç®— <= val çš„æ•°ä¸­ï¼ŒåªåŒ…å«å› å­ 2 å’Œ 5 çš„æ•°çš„ä¸ªæ•°
ll get_f(ll val) {
    // ä½¿ç”¨ upper_bound æ‰¾åˆ°ç¬¬ä¸€ä¸ª > val çš„ä½ç½®
    // å‡å» begin() å¾—åˆ°çš„å°±æ˜¯ <= val çš„å…ƒç´ ä¸ªæ•°
    return upper_bound(nums.begin(), nums.end(), val) - nums.begin();
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);

    if (cin >> n) {
        // ç‰¹åˆ¤ n ç‰¹åˆ«å°çš„æƒ…å†µï¼Œé˜²æ­¢ init å‡ºé”™ï¼ˆè™½éå¿…è¦ä½†ä¸¥è°¨ï¼‰
        if (n == 0) { cout << 0 << endl; return 0; }

        init(); // é¢„å¤„ç†

        ll ans = 0;
        // æ•´é™¤åˆ†å—
        for (ll l = 1, r; l <= n; l = r + 1) {
            ll v = n / l;
            
            if (v == 0) r = n; // é˜²æ­¢é™¤0é”™è¯¯
            else r = n / v;
            
            // åŒºé—´ [l, r] å†… k çš„è´¡çŒ®
            ll k_count = count_coprime(r) - count_coprime(l - 1);
            
            // ç´¯åŠ ï¼škçš„æ•°é‡ * (v * f(v))
            ans += k_count * (v * get_f(v));
        }

        cout << ans << endl;
    }

    return 0;
}
```

-----

è¿™ç¯‡åšæ–‡æ¶µç›–äº†ä»é—®é¢˜åˆ†æã€æ•°å­¦è½¬åŒ–åˆ°ä»£ç ä¼˜åŒ–çš„å®Œæ•´è¿‡ç¨‹ã€‚

åœ¨å‘å¸ƒä¹‹å‰ï¼Œå»ºè®®ä½ å†æŠŠä»£ç å¤åˆ¶åˆ°ä½ çš„ IDE é‡Œï¼Œç”¨é¢˜ç›®ç»™å‡ºçš„æ ·ä¾‹ï¼ˆä¾‹å¦‚ `n=5` è¾“å‡º `21`ï¼‰æœ€åéªŒè¯ä¸€ä¸‹ï¼Œç¡®ä¿ä¸‡æ— ä¸€å¤±ã€‚ç¥ä½ çš„åšå®¢è¶Šæ¥è¶Šç«ï¼
