---
oj: "CF"
problem_id: "776B"
title: "Sherlock and his girlfriend"
date: 2025-12-13 23:44
toc: true
tags: ["数论","埃式筛"]
desc: ""
source: https://codeforces.com/problemset/problem/776/B
---

[[TOC]]

这份题目的解析侧重于**数论逻辑**和**贪心策略**。虽然题目看起来像是复杂的图论（图着色问题），但实际上它的核心数学规律非常简单。

以下是针对 **CF776B Sherlock and his girlfriend** 的详细解析：

-----

## 1 题目核心翻译

题目给定 $n$ 个珠宝，价格分别是 $2, 3, 4, \dots, n+1$。
**约束条件**：如果珠宝 A 的价格是珠宝 B 的价格的**素因子（质因子）**，那么 A 和 B 的颜色必须不同。
**目标**：用最少的颜色数量给所有珠宝上色。

-----

## 2 数学规律分析

我们需要分析数字之间的冲突关系。

  * **质数（Prime）的性质**：
    质数没有除 1 和自身以外的因子。因此，一个质数不可能拥有另一个（不等于它自身的）质因子。
    $\rightarrow$ **结论**：任意两个质数之间不会产生冲突。我们可以把所有的质数染成同一种颜色（比如颜色 1）。

  * **合数（Composite）的性质**：
    合数一定可以分解质因数。也就是说，合数一定有至少一个质因子。
    例如：$6$ 的质因子是 $2, 3$；$4$ 的质因子是 $2$。
    根据题目规则，合数必须和它的质因子颜色不同。
    既然我们将质数染成了颜色 1，那么合数必须染成颜色 2。

  * **合数与合数之间会冲突吗？**
    题目说：“当一件珠宝的价格是另一件珠宝的价格的**素因子**时...”。
    合数本身不是素数（质数），所以合数永远不可能充当“素因子”的角色。
    $\rightarrow$ **结论**：任意两个合数之间不需要根据此规则区分颜色。所有的合数都可以染成同一种颜色（比如颜色 2）。

## 3 最终策略

基于以上分析，我们只需要**两种颜色**就足够解决绝大多数情况：

1.  **颜色 1**：分配给所有 **质数**。
2.  **颜色 2**：分配给所有 **合数**。

### 验证逻辑：

  * **质数 vs 质数**：无冲突（颜色相同）。
  * **合数 vs 合数**：无冲突（颜色相同）。
  * **质数 vs 合数**：如果质数 $P$ 是合数 $C$ 的因子，它们颜色不同（$1 \neq 2$）。符合规则。

-----

## 4 特殊边界情况（坑点）

虽然理论上最多需要 2 种颜色，但我们需要考虑 $n$ 特别小的情况：

  * **当 $n=1$ 时**：
    价格序列为 $\{2\}$。只有一个质数，没有合数。
    只需要 **1 种颜色**。
  * **当 $n=2$ 时**：
    价格序列为 $\{2, 3\}$。两个都是质数，互不冲突。
    只需要 **1 种颜色**。
  * **当 $n \ge 3$ 时**：
    价格序列为 $\{2, 3, 4, \dots\}$。出现了合数 $4$。
    此时必须使用 **2 种颜色**。

-----

## 5 算法实现思路

由于数据范围是 $n \le 100,000$，我们需要一种快速的方法来判断每个数是质数还是合数。

**埃氏筛法（Sieve of Eratosthenes）** 是最佳选择：

1.  建立一个布尔数组或标记数组 `del[]`，初始化为 0（假设都是质数）。
2.  从 2 开始遍历到 $n+1$。
3.  如果当前数 $i$ 是质数（`del[i] == 0`）：
      * 将它的所有倍数（$2i, 3i, 4i \dots$）标记为合数（`del[j] = 1`）。
4.  最后输出时：
      * 如果 `del[i] == 0`（质数），输出 1。
      * 如果 `del[i] == 1`（合数），输出 2。

## 6 复杂度分析

  * **时间复杂度**：埃氏筛法的时间复杂度是 $O(N \log \log N)$，对于 $10^5$ 的数据量，这几乎是线性的，运行非常快（远小于 1 秒）。
  * **空间复杂度**：$O(N)$，需要一个数组存储标记。

-----

## 7 代码

@include-code(./1.cpp, cpp)


