## `__builtin_clz(x)`

### 1. 含义拆解
* **全称**：**C**ount **L**eading **Z**eros
* **中文意思**：统计前导零（即二进制表示中，左边有多少个连续的 0）。
* **对象**：默认针对 **32位** 无符号整数（`unsigned int`）。

---

### 2. 图解演示
假设 `int` 是 **32 位** 的。

**例子 1：数字 16**
* 二进制表示（补足 32 位）：
    `0000 0000 0000 0000 0000 0000 0001 0000`
* **分析**：
    * 最右边起，第 4 位（下标从0开始）是 `1`。
    * 除了最后 5 位（`10000`），前面的 **27** 位全都是 `0`。
* **结果**：`__builtin_clz(16)` 返回 **27**。

**例子 2：数字 6**
* 二进制表示：
    `0000 ... 0000 0110` (前面有 29 个 0，后面是 110)
* **结果**：`__builtin_clz(6)` 返回 **29**。

---

### 3. 核心用途：快速计算 $\log_2(x)$
这是它在 ST 表、线段树等算法中最常见的用法。

因为一个数字的**最高有效位（Most Significant Bit）**的位置，直接对应它的 $\log_2$ 值。
对于 32 位整数，公式如下：

$$\lfloor \log_2(x) \rfloor = 31 - \text{\_\_builtin\_clz}(x)$$

**推导逻辑：**
1.  总位宽是 32。
2.  减去前面的 0 的个数，就剩下了**从最高位 1 开始到最低位的长度**。
3.  长度减 1，就是最高位 1 的**下标**，也就是 $\log_2(x)$。

> **注意：** GCC 提供了一个封装好的函数 **`std::__lg(x)`**（非标准但常用），其内部实现正是 `31 - __builtin_clz(x)`。在 ST 表中可以直接用 `__lg(len)`。

---

### 4. 两个必须记住的“坑”

1.  **输入为 0 的未定义行为 (UB)**
    * `__builtin_clz(0)` 的结果是**未定义**的。在不同机器上可能会崩溃、返回 31、返回 32 或返回随机值。
    * **解决**：确保传入 ST 表查询长度时 `len > 0`（ST 表查询通常都不涉及长度 0）。

2.  **数据类型**
    * `__builtin_clz(x)` 默认处理 `int` (32位)。
    * 如果你开的是 `long long`，必须用 **`__builtin_clzll(x)`**。
    * **公式变为**：`63 - __builtin_clzll(x)`。

---




## `__builtin_ctz(x)`

这个函数名的全称是 **C**ount **T**railing **Z**eros（统计尾部零）。

### 详细说明

1.  **功能**：
    返回整数 $x$ 的二进制表示中，**从最低位（右边）开始连续 0 的个数**。

      * 例如：`12` 的二进制是 `1100`，末尾有 2 个零，`__builtin_ctz(12)` 返回 `2`。
      * 例如：`8` 的二进制是 `1000`，`__builtin_ctz(8)` 返回 `3`。

2.  **变体（针对不同数据类型）**：

      * `int`: `__builtin_ctz(unsigned int x)`
      * `long`: `__builtin_ctz**l**(unsigned long x)`
      * `long long`: `__builtin_ctz**ll**(unsigned long long x)`

3.  **⚠️ 重要注意事项**：
    和 `__builtin_clz` 一样，**如果传入的参数是 0，该函数的行为是未定义的（Undefined Behavior）**。在使用前通常需要特判 `x != 0`。

-----

### C++20 标准写法

如果你使用的是 C++20 或更高版本，推荐使用标准库 `<bit>` 头文件中的函数，它解决了 undefined behavior 的问题，更加安全：

```cpp
#include <bit>

// 如果 x 是 0，它会安全地返回类型的位宽（例如 32 或 64）
int zeros = std::countr_zero(x); 
```

### 总结

| 函数 | 作用 | 针对类型 | 常用公式 ($\lfloor \log_2 x \rfloor$) |
| :--- | :--- | :--- | :--- |
| `__builtin_clz(x)` | 数左边的 0 | `int` (32位) | `31 - __builtin_clz(x)` |
| `__builtin_clzll(x)`| 数左边的 0 | `long long` (64位) | `63 - __builtin_clzll(x)` |