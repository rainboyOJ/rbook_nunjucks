太棒了！FHQ-Treap 的最大魅力就在于它既能做“普通平衡树”（维护数值集合），又能做“文艺平衡树”（维护序列区间）。

为了让你的练习路径平滑且高效，我为你精心挑选了 5 道经典题目，按照**难度**和**功能点**循序渐进。

---

### 第一阶段：基本功（按数值分裂）

这阶段主要练习你刚才写的模板，巩固 `split` (按数值) 和 `merge` 的逻辑。

#### 1. 洛谷 P3369 【模板】普通平衡树
* **链接**：[Luogu P3369](https://www.luogu.com.cn/problem/P3369)
* **描述**：最经典的板子题。要求实现插入、删除、查询排名、查询值、前驱、后继。
* **重点**：
    * 直接使用我刚才给你的代码即可 AC。
    * **建议尝试**：先用 `split` 版本的 rank/pre/nxt 通过一次，再把那三个函数改成 **BST 写法** 再提交一次，感受一下速度和代码长度的区别。

#### 3. 洛谷 P1486 [NOI2004] 郁闷的出纳员
* **链接**：[Luogu P1486](https://www.luogu.com.cn/problem/P1486)
* **描述**：支持插入员工工资、所有员工加工资、所有员工扣工资、开除工资低于某线的员工。
* **重点**：
    * **全局标记 (Global Tag)**：因为是“所有人”加减工资，不需要给树打标记，只需要维护一个全局变量 `delta`。存入树的值是 `实际工资 - delta`。
    * **批量删除**：这是 FHQ-Treap 的强项！当有人工资低于标准时，你只需要把树按 `limit - delta` **分裂 (split)** 成两半，把小的那一半直接扔掉（不 merge 回去），就完成了批量删除。

---

### 第二阶段：进阶（按排名分裂 / 区间操作）

**这是 FHQ-Treap 的分水岭。**
做下面这些题时，你的 `split` 函数需要修改：不再是比较 `val`，而是比较 `tr[l].sz`。这种树不再维护“数值的大小顺序”，而是维护“数组下标的顺序”。

#### 4. 洛谷 P3391 【模板】文艺平衡树
* **链接**：[Luogu P3391](https://www.luogu.com.cn/problem/P3391)
* **描述**：给定一个序列 `1...N`，进行多次区间翻转操作 `[L, R]`，最后输出序列。
* **核心变化**：
    * **Split by Rank**：`void split(int u, int k, int &x, int &y)` (把树切成前 k 个和 剩下的)。
    * **Lazy Tag**：需要实现 `pushdown(u)`，处理翻转标记。每次 `split` 和 `merge` 访问节点前都要 `pushdown`。
    * **区间操作**：翻转 `[L, R]` 的逻辑是：
        1. `split` 出 `[1, R]` 和 `[R+1, N]`。
        2. 再把 `[1, R]` `split` 出 `[1, L-1]` 和 `[L, R]`。
        3. 此时中间那棵树就是区间 `[L, R]`，给它的根节点打上翻转标记 `reverse ^= 1`。
        4. 全部 `merge` 回去。

#### 5. Codeforces 863D - Yet Another Array Queries Problem
* **链接**：[Codeforces 863D](https://codeforces.com/problemset/problem/863/D)
* **描述**：支持两种操作：区间循环右移、区间翻转。
* **重点**：
    * 这是检验你是否掌握“按排名分裂”的好题。
    * **区间移动**：其实就是通过两次 `split` 把区间拿出来，切一切，换个顺序 `merge` 回去。相比线段树，这是平衡树特有的超能力。

---

### 练习建议

1.  **不要急着做第四题（文艺平衡树）**。先确保前三题你写得很顺手，对 `split` (按值) 的逻辑烂熟于心。
2.  **注意区分**：
    * 前三题（普通平衡树）：树的中序遍历是**数值有序**的。
    * 后两题（文艺平衡树）：树的中序遍历是**数组下标有序**的。
3.  **调试技巧**：如果你写挂了，写一个 `dfs` 函数中序遍历输出整棵树，看能不能还原出当前的序列，这是最直观的调试方法。

你先试试 **P3369**？如果 AC 了或者遇到 bug，随时把代码发给我。